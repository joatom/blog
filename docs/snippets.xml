<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>jo@tom</title>
<link>https://joatom.github.io/blog/snippets.html</link>
<atom:link href="https://joatom.github.io/blog/snippets.xml" rel="self" type="application/rss+xml"/>
<description>AI curios</description>
<generator>quarto-1.2.256</generator>
<lastBuildDate>Wed, 01 Feb 2023 23:00:00 GMT</lastBuildDate>
<item>
  <title>Numeric Dataset</title>
  <dc:creator>Johannes Tomasoni</dc:creator>
  <link>https://joatom.github.io/blog/snippets/2023-02-02-num_dataset/index.html</link>
  <description><![CDATA[ 




<section id="about" class="level1">
<h1>About</h1>
<p>A basic Dataset for numeric features from a Pandas dataframe. If there is enough memory the dataframe can be converted into a FloatTensor to speed up data access.</p>
<p>Dataframe consists of feature columns and target columns and a kfold column.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="kw" style="color: #003B4F;">class</span> NumDataset(torch.utils.data.Dataset):</span>
<span id="cb1-2">    </span>
<span id="cb1-3">    <span class="kw" style="color: #003B4F;">def</span> <span class="fu" style="color: #4758AB;">__init__</span>(<span class="va" style="color: #111111;">self</span>, df, features <span class="op" style="color: #5E5E5E;">=</span> [], targets: <span class="bu" style="color: null;">list</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">None</span>, kfolds<span class="op" style="color: #5E5E5E;">=</span>[<span class="dv" style="color: #AD0000;">0</span>]):</span>
<span id="cb1-4">        </span>
<span id="cb1-5">        <span class="cf" style="color: #003B4F;">if</span> targets:</span>
<span id="cb1-6">            <span class="va" style="color: #111111;">self</span>.targets <span class="op" style="color: #5E5E5E;">=</span> torch.FloatTensor(df[df[<span class="st" style="color: #20794D;">'kfold'</span>].isin(kfolds)][targets].values.reshape(<span class="op" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>,<span class="bu" style="color: null;">len</span>(targets)))</span>
<span id="cb1-7">        <span class="cf" style="color: #003B4F;">else</span>:</span>
<span id="cb1-8">            <span class="va" style="color: #111111;">self</span>.targets <span class="op" style="color: #5E5E5E;">=</span> torch.zeros(<span class="bu" style="color: null;">len</span>(targets))</span>
<span id="cb1-9">        </span>
<span id="cb1-10">        <span class="co" style="color: #5E5E5E;"># Convert Dataframe into FloatTensor for speed up</span></span>
<span id="cb1-11">        <span class="va" style="color: #111111;">self</span>.df <span class="op" style="color: #5E5E5E;">=</span> torch.FloatTensor(df[features].values.reshape(<span class="op" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>,<span class="bu" style="color: null;">len</span>(features)))</span>
<span id="cb1-12">    </span>
<span id="cb1-13">    <span class="kw" style="color: #003B4F;">def</span> <span class="fu" style="color: #4758AB;">__len__</span>(<span class="va" style="color: #111111;">self</span>):</span>
<span id="cb1-14">        <span class="cf" style="color: #003B4F;">return</span> <span class="bu" style="color: null;">len</span>(<span class="va" style="color: #111111;">self</span>.df)</span>
<span id="cb1-15">    </span>
<span id="cb1-16">    <span class="kw" style="color: #003B4F;">def</span> <span class="fu" style="color: #4758AB;">__getitem__</span>(<span class="va" style="color: #111111;">self</span>, item):</span>
<span id="cb1-17">        </span>
<span id="cb1-18">        <span class="cf" style="color: #003B4F;">return</span> <span class="va" style="color: #111111;">self</span>.df[item], <span class="va" style="color: #111111;">self</span>.targets[item]</span>
<span id="cb1-19">        </span></code></pre></div>
<p>For dict usage in Module.forward define dataset like this:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">....    </span>
<span id="cb2-2">    <span class="kw" style="color: #003B4F;">def</span> <span class="fu" style="color: #4758AB;">__getitem__</span>(<span class="va" style="color: #111111;">self</span>, item):</span>
<span id="cb2-3">        </span>
<span id="cb2-4">        <span class="cf" style="color: #003B4F;">return</span> {<span class="st" style="color: #20794D;">'data'</span>: <span class="va" style="color: #111111;">self</span>.df[item], <span class="st" style="color: #20794D;">'targets'</span>: <span class="va" style="color: #111111;">self</span>.targets[item]}</span>
<span id="cb2-5">....</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="kw" style="color: #003B4F;">class</span> MyModel(nn.Module):</span>
<span id="cb2-8">  ....</span>
<span id="cb2-9">  <span class="kw" style="color: #003B4F;">def</span> forward(<span class="va" style="color: #111111;">self</span>, data, targets):</span>
<span id="cb2-10">    ....</span></code></pre></div>
<p>DataLoader in Fastai:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">train_ds <span class="op" style="color: #5E5E5E;">=</span> NumDataset(df <span class="op" style="color: #5E5E5E;">=</span> train, features <span class="op" style="color: #5E5E5E;">=</span> FEATURES, targets<span class="op" style="color: #5E5E5E;">=</span>TARGETS, kfolds <span class="op" style="color: #5E5E5E;">=</span> [<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">3</span>,<span class="dv" style="color: #AD0000;">4</span>])</span>
<span id="cb3-2">valid_ds <span class="op" style="color: #5E5E5E;">=</span> NumDataset(df <span class="op" style="color: #5E5E5E;">=</span> train, features <span class="op" style="color: #5E5E5E;">=</span> FEATURES, targets<span class="op" style="color: #5E5E5E;">=</span>TARGETS, kfolds <span class="op" style="color: #5E5E5E;">=</span> [<span class="dv" style="color: #AD0000;">0</span>])</span>
<span id="cb3-3"></span>
<span id="cb3-4">train_dl <span class="op" style="color: #5E5E5E;">=</span> DataLoader(train_ds, batch_size<span class="op" style="color: #5E5E5E;">=</span> BS_TRAIN, shuffle <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">True</span>, num_workers <span class="op" style="color: #5E5E5E;">=</span> WORKERS) </span>
<span id="cb3-5">valid_dl <span class="op" style="color: #5E5E5E;">=</span> DataLoader(valid_ds, batch_size<span class="op" style="color: #5E5E5E;">=</span> BS_TEST, shuffle <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">False</span>, num_workers <span class="op" style="color: #5E5E5E;">=</span> WORKERS)</span>
<span id="cb3-6"></span>
<span id="cb3-7">data <span class="op" style="color: #5E5E5E;">=</span> DataLoaders(train_dl, valid_dl).cuda() </span></code></pre></div>
<p>Training in Fastai:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">learn <span class="op" style="color: #5E5E5E;">=</span> Learner(data, MYMODEL, loss_func<span class="op" style="color: #5E5E5E;">=</span>MYLOSS, metrics<span class="op" style="color: #5E5E5E;">=</span>MYMETRICS)</span>
<span id="cb4-2"></span>
<span id="cb4-3">learn.fit_one_cycle(<span class="dv" style="color: #AD0000;">1</span>,<span class="fl" style="color: #AD0000;">1e-3</span>)</span></code></pre></div>


</section>

 ]]></description>
  <category>Pytorch</category>
  <category>ML</category>
  <guid>https://joatom.github.io/blog/snippets/2023-02-02-num_dataset/index.html</guid>
  <pubDate>Wed, 01 Feb 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Pandas styles</title>
  <dc:creator>Johannes Tomasoni</dc:creator>
  <link>https://joatom.github.io/blog/snippets/2022-11-20-pandas-styles/index.html</link>
  <description><![CDATA[ 




<section id="pandas-styles" class="level1">
<h1>Pandas styles</h1>
<p>A styling example from the blog post <a href="../../posts/2022-11-13-repay-vs-invest/index.html">Pay off Mortgage or Invest</a>. Includes MultiIndexed columns, bar charts, html table layout, et.</p>
<div class="cell" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1">df.columns <span class="op" style="color: #5E5E5E;">=</span> pd.MultiIndex.from_tuples([(<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Interest'</span>),</span>
<span id="cb1-2">                                        (<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Principal'</span>),</span>
<span id="cb1-3">                                        (<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Extra Payment'</span>),</span>
<span id="cb1-4">                                        (<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Loan Balance'</span>),</span>
<span id="cb1-5">                                        (<span class="st" style="color: #20794D;">'Investment'</span>, <span class="st" style="color: #20794D;">'Payment'</span>),</span>
<span id="cb1-6">                                        (<span class="st" style="color: #20794D;">'Investment'</span>, <span class="st" style="color: #20794D;">'Balance'</span>),</span>
<span id="cb1-7">                                        (<span class="st" style="color: #20794D;">'Appreciation'</span>, <span class="st" style="color: #20794D;">'Balance'</span>),</span>
<span id="cb1-8">                                        (<span class="st" style="color: #20794D;">'Net Worth'</span>, <span class="st" style="color: #20794D;">'w/o appr.'</span>),</span>
<span id="cb1-9">                                        (<span class="st" style="color: #20794D;">'Net Worth'</span>, <span class="st" style="color: #20794D;">'with appr.'</span>)], names<span class="op" style="color: #5E5E5E;">=</span>[<span class="st" style="color: #20794D;">''</span>,<span class="st" style="color: #20794D;">'Year'</span>])</span>
<span id="cb1-10">                                        </span>
<span id="cb1-11">vmin <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">-</span>interest_rate<span class="op" style="color: #5E5E5E;">*</span>principal</span>
<span id="cb1-12">vmax <span class="op" style="color: #5E5E5E;">=</span> m_payment<span class="op" style="color: #5E5E5E;">-</span>interest_rate<span class="op" style="color: #5E5E5E;">*</span>principal</span>
<span id="cb1-13"></span>
<span id="cb1-14">(df.style</span>
<span id="cb1-15">    .<span class="bu" style="color: null;">format</span>(<span class="st" style="color: #20794D;">'</span><span class="sc" style="color: #5E5E5E;">{:.0f}</span><span class="st" style="color: #20794D;">'</span>, na_rep<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">""</span>)</span>
<span id="cb1-16">    .bar(subset<span class="op" style="color: #5E5E5E;">=</span>pd.IndexSlice[df[df[(<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Interest'</span>)]<span class="op" style="color: #5E5E5E;">&lt;=</span><span class="dv" style="color: #AD0000;">0</span>].index,(<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Interest'</span>)],</span>
<span id="cb1-17">         align<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'right'</span>, vmin<span class="op" style="color: #5E5E5E;">=</span>vmin, vmax<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, cmap<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"autumn"</span>, </span>
<span id="cb1-18">         height<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, props<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"width: 100px; border-right: 1px solid gray;"</span></span>
<span id="cb1-19">        )</span>
<span id="cb1-20">    .bar(subset<span class="op" style="color: #5E5E5E;">=</span>pd.IndexSlice[df[df[(<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Principal'</span>)]<span class="op" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">0</span>].index,(<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Principal'</span>)],</span>
<span id="cb1-21">         align<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'left'</span>, vmin<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, vmax<span class="op" style="color: #5E5E5E;">=</span>m_payment, cmap<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"summer_r"</span>, </span>
<span id="cb1-22">         height<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, props<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"width: 100px; border-right: 1px solid gray;"</span></span>
<span id="cb1-23">        )</span>
<span id="cb1-24">    .bar(subset<span class="op" style="color: #5E5E5E;">=</span>[(<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Extra Payment'</span>)], align<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'left'</span>, vmin<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, vmax<span class="op" style="color: #5E5E5E;">=</span>lump_sum, cmap<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"summer_r"</span>, </span>
<span id="cb1-25">         height<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, props<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"width: 80px; border-right: 1px solid gray; border-left: 1px solid gray;"</span></span>
<span id="cb1-26">        )</span>
<span id="cb1-27">    .bar(subset<span class="op" style="color: #5E5E5E;">=</span>[(<span class="st" style="color: #20794D;">'Investment'</span>, <span class="st" style="color: #20794D;">'Payment'</span>)], align<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'left'</span>, vmin<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, vmax<span class="op" style="color: #5E5E5E;">=</span><span class="bu" style="color: null;">max</span>(lump_sum, m_payment), cmap<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"summer_r"</span>, </span>
<span id="cb1-28">         height<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, props<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"width: 80px; border-right: 1px solid gray; border-left: 1px solid gray;"</span></span>
<span id="cb1-29">        )</span>
<span id="cb1-30">    </span>
<span id="cb1-31">    .bar(subset<span class="op" style="color: #5E5E5E;">=</span>[(<span class="st" style="color: #20794D;">'Mortgage'</span>, <span class="st" style="color: #20794D;">'Loan Balance'</span>)], align<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'right'</span>, vmin<span class="op" style="color: #5E5E5E;">=-</span><span class="fl" style="color: #AD0000;">2.5</span><span class="op" style="color: #5E5E5E;">*</span>principal, vmax<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, cmap<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"PuRd_r"</span>, </span>
<span id="cb1-32">         height<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">100</span>, props<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"width: 80px; border-right: 1px solid gray; border-left: 1px solid gray;"</span></span>
<span id="cb1-33">        )</span>
<span id="cb1-34">    .bar(subset<span class="op" style="color: #5E5E5E;">=</span>[(<span class="st" style="color: #20794D;">'Appreciation'</span>, <span class="st" style="color: #20794D;">'Balance'</span>)], align<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'left'</span>, vmin<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, vmax<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">2.5</span><span class="op" style="color: #5E5E5E;">*</span>principal, cmap<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"Blues"</span>, </span>
<span id="cb1-35">         height<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">100</span>, props<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"width: 80px; border-right: 1px solid gray;"</span></span>
<span id="cb1-36">        )</span>
<span id="cb1-37">    .bar(subset<span class="op" style="color: #5E5E5E;">=</span>[(<span class="st" style="color: #20794D;">'Investment'</span>, <span class="st" style="color: #20794D;">'Balance'</span>)], align<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'left'</span>, vmin<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, vmax<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">2.5</span><span class="op" style="color: #5E5E5E;">*</span>principal, cmap<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"Blues"</span>, </span>
<span id="cb1-38">         height<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">100</span>, props<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"width: 80px; border-right: 1px solid gray; border-left: 1px solid gray;"</span></span>
<span id="cb1-39">        )</span>
<span id="cb1-40">    .bar(subset<span class="op" style="color: #5E5E5E;">=</span>[(<span class="st" style="color: #20794D;">'Net Worth'</span>, <span class="st" style="color: #20794D;">'w/o appr.'</span>)], align<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'left'</span>, vmin<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, vmax<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">2.5</span><span class="op" style="color: #5E5E5E;">*</span>principal, cmap<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"Blues"</span>, </span>
<span id="cb1-41">         height<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">100</span>, props<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"width: 80px; border-right: 1px solid gray;"</span></span>
<span id="cb1-42">        )</span>
<span id="cb1-43">    .bar(subset<span class="op" style="color: #5E5E5E;">=</span>[(<span class="st" style="color: #20794D;">'Net Worth'</span>, <span class="st" style="color: #20794D;">'with appr.'</span>)], align<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'left'</span>, vmin<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, vmax<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">2.5</span><span class="op" style="color: #5E5E5E;">*</span>principal, cmap<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"Blues"</span>, </span>
<span id="cb1-44">         height<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">80</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">100</span>, props<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"width: 80px; border-right: 1px solid gray;"</span></span>
<span id="cb1-45">        )</span>
<span id="cb1-46">    .set_table_styles({</span>
<span id="cb1-47">       (<span class="st" style="color: #20794D;">'Total:'</span>): [{<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'th'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'border-top: 1px solid gray; border-bottom: 1px solid gray'</span>},</span>
<span id="cb1-48">                  {<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'td'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'border-top: 1px solid gray; border-bottom: 1px solid gray'</span>}]</span>
<span id="cb1-49">       }, overwrite<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">False</span>, axis<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">1</span>)</span>
<span id="cb1-50">    .set_table_styles([</span>
<span id="cb1-51">        {<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'table'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'border-spacing: 2px'</span>},</span>
<span id="cb1-52">        {<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'thead'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'border: 1px solid gray'</span>}, </span>
<span id="cb1-53">        {<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'th'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'text-align: center; padding: 4.5px;'</span>},</span>
<span id="cb1-54">        {<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'th.col_heading'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'border: 1px solid gray'</span>},</span>
<span id="cb1-55">        {<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'tbody'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'border: 1px solid gray'</span>},</span>
<span id="cb1-56">        {<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'td'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'text-align: center; border-left: 1px solid gray; border-right: 1px solid gray;'</span>}</span>
<span id="cb1-57">       ], overwrite<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">False</span>)</span>
<span id="cb1-58">    .set_table_styles({</span>
<span id="cb1-59">            (<span class="st" style="color: #20794D;">'Investment'</span>, <span class="st" style="color: #20794D;">'Balance'</span>): [{<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'th'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'border-right: 1px solid gray'</span>},</span>
<span id="cb1-60">                       {<span class="st" style="color: #20794D;">'selector'</span>: <span class="st" style="color: #20794D;">'td'</span>, <span class="st" style="color: #20794D;">'props'</span>: <span class="st" style="color: #20794D;">'border-right: 1px solid gray'</span>}]</span>
<span id="cb1-61">            }, overwrite<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">False</span>, axis<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>)</span>
<span id="cb1-62">)</span></code></pre></div>
<div class="cell-output cell-output-display">

<style type="text/css">
#T_8e020 th.row30 {
  border-top: 1px solid gray;
  border-bottom: 1px solid gray;
}
#T_8e020 td.row30 {
  border-top: 1px solid gray;
  border-bottom: 1px solid gray;
}
#T_8e020 table {
  border-spacing: 2px;
}
#T_8e020 thead {
  border: 1px solid gray;
}
#T_8e020 th {
  text-align: center;
  padding: 4.5px;
}
#T_8e020 th.col_heading {
  border: 1px solid gray;
}
#T_8e020 tbody {
  border: 1px solid gray;
}
#T_8e020 td {
  text-align: center;
  border-left: 1px solid gray;
  border-right: 1px solid gray;
}
#T_8e020 th.col5 {
  border-right: 1px solid gray;
}
#T_8e020 td.col5 {
  border-right: 1px solid gray;
}
#T_8e020_row0_col2, #T_8e020_row0_col4, #T_8e020_row0_col5, #T_8e020_row1_col2, #T_8e020_row1_col4, #T_8e020_row1_col5, #T_8e020_row2_col2, #T_8e020_row3_col2, #T_8e020_row3_col4, #T_8e020_row4_col2, #T_8e020_row4_col4, #T_8e020_row5_col2, #T_8e020_row5_col4, #T_8e020_row6_col2, #T_8e020_row6_col4, #T_8e020_row7_col2, #T_8e020_row7_col4, #T_8e020_row8_col2, #T_8e020_row8_col4, #T_8e020_row9_col2, #T_8e020_row9_col4, #T_8e020_row10_col2, #T_8e020_row10_col4, #T_8e020_row11_col2, #T_8e020_row11_col4, #T_8e020_row12_col2, #T_8e020_row12_col4, #T_8e020_row13_col2, #T_8e020_row13_col4, #T_8e020_row14_col2, #T_8e020_row14_col4, #T_8e020_row15_col2, #T_8e020_row15_col4, #T_8e020_row16_col2, #T_8e020_row16_col4, #T_8e020_row17_col2, #T_8e020_row17_col4, #T_8e020_row18_col2, #T_8e020_row18_col4, #T_8e020_row19_col2, #T_8e020_row19_col4, #T_8e020_row20_col2, #T_8e020_row20_col4, #T_8e020_row21_col2, #T_8e020_row21_col4, #T_8e020_row22_col2, #T_8e020_row22_col4, #T_8e020_row23_col2, #T_8e020_row23_col4, #T_8e020_row24_col2, #T_8e020_row24_col4, #T_8e020_row25_col2, #T_8e020_row25_col4, #T_8e020_row26_col2, #T_8e020_row26_col4, #T_8e020_row27_col2, #T_8e020_row27_col4, #T_8e020_row28_col2, #T_8e020_row28_col4, #T_8e020_row29_col2, #T_8e020_row29_col3, #T_8e020_row30_col2, #T_8e020_row30_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
}
#T_8e020_row0_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 60.0%, #cd8bc2 60.0%, #cd8bc2 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row0_col6, #T_8e020_row0_col7, #T_8e020_row0_col8 {
  width: 80px;
  border-right: 1px solid gray;
}
#T_8e020_row1_col0, #T_8e020_row30_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #ff0000 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row1_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #7fbf66 40.0%, transparent 40.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row1_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 61.0%, #cb8fc5 61.0%, #cb8fc5 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row1_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f7fbff 0.0%, transparent 0.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row1_col7, #T_8e020_row1_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f5fafe 1.0%, transparent 1.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row2_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 2.0%, #ff0600 2.0%, #ff0600 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row2_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #7cbe66 41.0%, transparent 41.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row2_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 62.0%, #ca92c6 62.0%, #ca92c6 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row2_col4, #T_8e020_row30_col4 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #008066 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row2_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #ebf3fb 6.0%, transparent 6.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row2_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f7fbff 0.1%, transparent 0.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row2_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e7f1fa 8.0%, transparent 8.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row2_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e7f1fa 8.1%, transparent 8.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row3_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 4.1%, #ff0c00 4.1%, #ff0c00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row3_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #79bc66 42.0%, transparent 42.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row3_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 63.1%, #ca96c8 63.1%, #ca96c8 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row3_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #ebf3fb 6.2%, transparent 6.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row3_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f7fbff 0.2%, transparent 0.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row3_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e5eff9 9.2%, transparent 9.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row3_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e4eff9 9.4%, transparent 9.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row4_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 6.2%, #ff1300 6.2%, #ff1300 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row4_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #76bb66 43.1%, transparent 43.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row4_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 64.2%, #cb99ca 64.2%, #cb99ca 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row4_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #eaf3fb 6.3%, transparent 6.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row4_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f7fbff 0.3%, transparent 0.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row4_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e3eef8 10.5%, transparent 10.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row4_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e2edf8 10.8%, transparent 10.8%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row5_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 8.3%, #ff1a00 8.3%, #ff1a00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row5_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #72b866 44.2%, transparent 44.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row5_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 65.3%, #cc9dcc 65.3%, #cc9dcc 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row5_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #eaf3fb 6.5%, transparent 6.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row5_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f6faff 0.5%, transparent 0.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row5_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #dfecf7 11.8%, transparent 11.8%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row5_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #dfebf7 12.3%, transparent 12.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row6_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 10.5%, #ff2100 10.5%, #ff2100 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row6_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #6fb766 45.3%, transparent 45.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row6_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 66.4%, #cc9fcd 66.4%, #cc9fcd 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row6_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #eaf2fb 6.7%, transparent 6.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row6_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f5fafe 0.8%, transparent 0.8%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row6_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #ddeaf7 13.1%, transparent 13.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row6_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #dce9f6 13.9%, transparent 13.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row7_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 12.8%, #ff2800 12.8%, #ff2800 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row7_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #6bb566 46.4%, transparent 46.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row7_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 67.5%, #cda3cf 67.5%, #cda3cf 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row7_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #eaf2fb 6.9%, transparent 6.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row7_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f5fafe 1.1%, transparent 1.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row7_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #dbe9f6 14.4%, transparent 14.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row7_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #d9e7f5 15.6%, transparent 15.6%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row8_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 15.1%, #ff3000 15.1%, #ff3000 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row8_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #67b366 47.5%, transparent 47.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row8_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 68.7%, #cea6d0 68.7%, #cea6d0 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row8_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e9f2fa 7.1%, transparent 7.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row8_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f5f9fe 1.5%, transparent 1.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row8_col7, #T_8e020_row22_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #d8e7f5 15.8%, transparent 15.8%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row8_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #d5e5f4 17.3%, transparent 17.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row9_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 17.5%, #ff3700 17.5%, #ff3700 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row9_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #64b266 48.7%, transparent 48.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row9_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 70.0%, #d0abd3 70.0%, #d0abd3 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row9_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e9f2fa 7.3%, transparent 7.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row9_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f4f9fe 1.9%, transparent 1.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row9_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #d5e5f4 17.2%, transparent 17.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row9_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #d1e2f3 19.2%, transparent 19.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row10_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 19.9%, #ff3f00 19.9%, #ff3f00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row10_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #60b066 50.0%, transparent 50.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row10_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 71.2%, #d1aed4 71.2%, #d1aed4 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row10_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e8f1fa 7.5%, transparent 7.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row10_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f2f8fd 2.5%, transparent 2.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row10_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #d3e3f3 18.7%, transparent 18.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row10_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #cde0f1 21.1%, transparent 21.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row11_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 22.4%, #ff4700 22.4%, #ff4700 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row11_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #5cae66 51.2%, transparent 51.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row11_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 72.5%, #d2b2d6 72.5%, #d2b2d6 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row11_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e8f1fa 7.7%, transparent 7.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row11_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f2f7fd 3.0%, transparent 3.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row11_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #d0e1f2 20.2%, transparent 20.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row11_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #caddf0 23.2%, transparent 23.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row12_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 25.0%, #ff4f00 25.0%, #ff4f00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row12_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #58ac66 52.5%, transparent 52.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row12_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 73.8%, #d3b5d8 73.8%, #d3b5d8 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row12_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e7f1fa 7.9%, transparent 7.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row12_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #f0f6fd 3.7%, transparent 3.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row12_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #cddff1 21.7%, transparent 21.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row12_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #c4daee 25.4%, transparent 25.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row13_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 27.6%, #ff5800 27.6%, #ff5800 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row13_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #53a966 53.8%, transparent 53.8%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row13_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 75.1%, #d4bada 75.1%, #d4bada 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row13_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e7f1fa 8.1%, transparent 8.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row13_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #eef5fc 4.4%, transparent 4.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row13_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #caddf0 23.3%, transparent 23.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row13_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #bed8ec 27.7%, transparent 27.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row14_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 30.3%, #ff6000 30.3%, #ff6000 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row14_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #4fa766 55.1%, transparent 55.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row14_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 76.5%, #d6bedc 76.5%, #d6bedc 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row14_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e7f0fa 8.4%, transparent 8.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row14_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #edf4fc 5.3%, transparent 5.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row14_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #c7dbef 24.9%, transparent 24.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row14_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #b5d4e9 30.2%, transparent 30.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row15_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 33.0%, #ff6900 33.0%, #ff6900 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row15_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #4ba566 56.5%, transparent 56.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row15_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 77.9%, #d9c3df 77.9%, #d9c3df 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row15_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e7f0fa 8.6%, transparent 8.6%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row15_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #ebf3fb 6.2%, transparent 6.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row15_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #c2d9ee 26.5%, transparent 26.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row15_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #aed1e7 32.7%, transparent 32.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row16_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 35.9%, #ff7200 35.9%, #ff7200 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row16_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #46a266 57.9%, transparent 57.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row16_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 79.4%, #dbc8e2 79.4%, #dbc8e2 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row16_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e6f0f9 8.8%, transparent 8.8%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row16_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e9f2fa 7.2%, transparent 7.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row16_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #bcd7eb 28.2%, transparent 28.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row16_col8, #T_8e020_row20_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #a5cde3 35.4%, transparent 35.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row17_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 38.8%, #ff7c00 38.8%, #ff7c00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row17_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #41a066 59.4%, transparent 59.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row17_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 80.9%, #ddcde4 80.9%, #ddcde4 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row17_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e5eff9 9.1%, transparent 9.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row17_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e7f0fa 8.4%, transparent 8.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row17_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #b7d4ea 29.9%, transparent 29.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row17_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #9ac8e0 38.3%, transparent 38.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row18_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 41.7%, #ff8500 41.7%, #ff8500 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row18_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #3d9e66 60.9%, transparent 60.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row18_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 82.4%, #dfd1e6 82.4%, #dfd1e6 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row18_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e5eff9 9.3%, transparent 9.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row18_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e4eff9 9.6%, transparent 9.6%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row18_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #b0d2e7 31.7%, transparent 31.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row18_col8, #T_8e020_row23_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #8fc2de 41.3%, transparent 41.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row19_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 44.8%, #ff8f00 44.8%, #ff8f00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row19_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #389c66 62.4%, transparent 62.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row19_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 83.9%, #e2d6e9 83.9%, #e2d6e9 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row19_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e4eff9 9.6%, transparent 9.6%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row19_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #e1edf8 10.9%, transparent 10.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row19_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #abd0e6 33.5%, transparent 33.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row19_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #82bbdb 44.5%, transparent 44.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row20_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 47.9%, #ff9900 47.9%, #ff9900 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row20_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #339966 63.9%, transparent 63.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row20_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 85.5%, #e4dbec 85.5%, #e4dbec 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row20_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e3eef9 9.9%, transparent 9.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row20_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #dfebf7 12.4%, transparent 12.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row20_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #74b3d8 47.8%, transparent 47.8%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row21_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 51.1%, #ffa300 51.1%, #ffa300 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row21_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #2e9666 65.5%, transparent 65.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row21_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 87.2%, #e7e1ef 87.2%, #e7e1ef 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row21_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e3eef9 10.1%, transparent 10.1%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row21_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #dce9f6 14.0%, transparent 14.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row21_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #9fcae1 37.3%, transparent 37.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row21_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #66abd4 51.3%, transparent 51.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row22_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 54.4%, #ffad00 54.4%, #ffad00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row22_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #299466 67.2%, transparent 67.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row22_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 88.9%, #e9e3f0 88.9%, #e9e3f0 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row22_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e3eef8 10.4%, transparent 10.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row22_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #97c6df 39.3%, transparent 39.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row22_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #5ba3d0 55.0%, transparent 55.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row23_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 57.7%, #ffb800 57.7%, #ffb800 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row23_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #239166 68.9%, transparent 68.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row23_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 90.6%, #ebe6f1 90.6%, #ebe6f1 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row23_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e2edf8 10.7%, transparent 10.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row23_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #d4e4f4 17.6%, transparent 17.6%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row23_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #4e9acb 58.9%, transparent 58.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row24_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 61.2%, #ffc300 61.2%, #ffc300 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row24_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #1e8e66 70.6%, transparent 70.6%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row24_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 92.3%, #ede9f3 92.3%, #ede9f3 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row24_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e1edf8 11.0%, transparent 11.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row24_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #d0e2f2 19.7%, transparent 19.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row24_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #85bcdc 43.4%, transparent 43.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row24_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #4090c5 63.0%, transparent 63.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row25_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 64.7%, #ffcf00 64.7%, #ffcf00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row25_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #188c66 72.3%, transparent 72.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row25_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 94.2%, #f0ecf5 94.2%, #f0ecf5 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row25_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e1edf8 11.3%, transparent 11.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row25_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #ccdff1 21.9%, transparent 21.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row25_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #7db8da 45.5%, transparent 45.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row25_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #3585bf 67.4%, transparent 67.4%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row26_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 68.3%, #ffda00 68.3%, #ffda00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row26_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #128866 74.2%, transparent 74.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row26_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 96.0%, #f2eef6 96.0%, #f2eef6 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row26_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #e0ecf8 11.6%, transparent 11.6%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row26_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #c7dcef 24.3%, transparent 24.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row26_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #75b4d8 47.7%, transparent 47.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row26_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #2979b9 71.9%, transparent 71.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row27_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 72.0%, #ffe600 72.0%, #ffe600 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row27_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #0c8666 76.0%, transparent 76.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row27_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 97.9%, #f4f1f7 97.9%, #f4f1f7 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row27_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #dfecf7 12.0%, transparent 12.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row27_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #c1d9ed 26.8%, transparent 26.8%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row27_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #6caed6 49.9%, transparent 49.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row27_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #1d6cb1 76.7%, transparent 76.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row28_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 75.8%, #fff200 75.8%, #fff200 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row28_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #068266 77.9%, transparent 77.9%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row28_col3 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, transparent 99.9%, #f7f4f9 99.9%, #f7f4f9 100.0%, transparent 100.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row28_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #dfebf7 12.3%, transparent 12.3%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row28_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #b8d5ea 29.5%, transparent 29.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row28_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #64a9d3 52.2%, transparent 52.2%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row28_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #135fa7 81.7%, transparent 81.7%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row29_col0 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, transparent 79.7%, #ffff00 79.7%, #ffff00 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row29_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #eef666 5.6%, transparent 5.6%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row29_col4 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #b0d866 24.8%, transparent 24.8%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row29_col5, #T_8e020_row30_col5 {
  width: 80px;
  border-right: 1px solid gray;
  border-left: 1px solid gray;
  background: linear-gradient(90deg, #dae8f6 14.5%, transparent 14.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row29_col6, #T_8e020_row30_col6 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #b3d3e8 31.0%, transparent 31.0%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row29_col7, #T_8e020_row30_col7 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #5ca4d0 54.5%, transparent 54.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row29_col8, #T_8e020_row30_col8 {
  width: 80px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #0c56a0 85.5%, transparent 85.5%) no-repeat center;
  background-size: 100% 80.0%;
}
#T_8e020_row30_col1 {
  width: 100px;
  border-right: 1px solid gray;
  background: linear-gradient(90deg, #008066 80.0%, transparent 80.0%) no-repeat center;
  background-size: 100% 80.0%;
}
</style>
<table id="T_8e020">
  <thead>
    <tr>
      <th class="index_name level0"></th>
      <th id="T_8e020_level0_col0" class="col_heading level0 col0" colspan="4">Mortgage</th>
      <th id="T_8e020_level0_col4" class="col_heading level0 col4" colspan="2">Investment</th>
      <th id="T_8e020_level0_col6" class="col_heading level0 col6">Appreciation</th>
      <th id="T_8e020_level0_col7" class="col_heading level0 col7" colspan="2">Net Worth</th>
    </tr>
    <tr>
      <th class="index_name level1">Year</th>
      <th id="T_8e020_level1_col0" class="col_heading level1 col0">Interest</th>
      <th id="T_8e020_level1_col1" class="col_heading level1 col1">Principal</th>
      <th id="T_8e020_level1_col2" class="col_heading level1 col2">Extra Payment</th>
      <th id="T_8e020_level1_col3" class="col_heading level1 col3">Loan Balance</th>
      <th id="T_8e020_level1_col4" class="col_heading level1 col4">Payment</th>
      <th id="T_8e020_level1_col5" class="col_heading level1 col5">Balance</th>
      <th id="T_8e020_level1_col6" class="col_heading level1 col6">Balance</th>
      <th id="T_8e020_level1_col7" class="col_heading level1 col7">w/o appr.</th>
      <th id="T_8e020_level1_col8" class="col_heading level1 col8">with appr.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_8e020_level0_row0" class="row_heading level0 row0">0</th>
      <td id="T_8e020_row0_col0" class="data row0 col0"></td>
      <td id="T_8e020_row0_col1" class="data row0 col1"></td>
      <td id="T_8e020_row0_col2" class="data row0 col2"></td>
      <td id="T_8e020_row0_col3" class="data row0 col3">-100000</td>
      <td id="T_8e020_row0_col4" class="data row0 col4"></td>
      <td id="T_8e020_row0_col5" class="data row0 col5">0</td>
      <td id="T_8e020_row0_col6" class="data row0 col6"></td>
      <td id="T_8e020_row0_col7" class="data row0 col7">0</td>
      <td id="T_8e020_row0_col8" class="data row0 col8"></td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row1" class="row_heading level0 row1">1</th>
      <td id="T_8e020_row1_col0" class="data row1 col0">-2500</td>
      <td id="T_8e020_row1_col1" class="data row1 col1">2500</td>
      <td id="T_8e020_row1_col2" class="data row1 col2">0</td>
      <td id="T_8e020_row1_col3" class="data row1 col3">-97500</td>
      <td id="T_8e020_row1_col4" class="data row1 col4">0</td>
      <td id="T_8e020_row1_col5" class="data row1 col5">0</td>
      <td id="T_8e020_row1_col6" class="data row1 col6">50</td>
      <td id="T_8e020_row1_col7" class="data row1 col7">2500</td>
      <td id="T_8e020_row1_col8" class="data row1 col8">2550</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row2" class="row_heading level0 row2">2</th>
      <td id="T_8e020_row2_col0" class="data row2 col0">-2438</td>
      <td id="T_8e020_row2_col1" class="data row2 col1">2562</td>
      <td id="T_8e020_row2_col2" class="data row2 col2">0</td>
      <td id="T_8e020_row2_col3" class="data row2 col3">-94938</td>
      <td id="T_8e020_row2_col4" class="data row2 col4">15000</td>
      <td id="T_8e020_row2_col5" class="data row2 col5">15000</td>
      <td id="T_8e020_row2_col6" class="data row2 col6">205</td>
      <td id="T_8e020_row2_col7" class="data row2 col7">20062</td>
      <td id="T_8e020_row2_col8" class="data row2 col8">20267</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row3" class="row_heading level0 row3">3</th>
      <td id="T_8e020_row3_col0" class="data row3 col0">-2373</td>
      <td id="T_8e020_row3_col1" class="data row3 col1">2627</td>
      <td id="T_8e020_row3_col2" class="data row3 col2">0</td>
      <td id="T_8e020_row3_col3" class="data row3 col3">-92311</td>
      <td id="T_8e020_row3_col4" class="data row3 col4">0</td>
      <td id="T_8e020_row3_col5" class="data row3 col5">15420</td>
      <td id="T_8e020_row3_col6" class="data row3 col6">471</td>
      <td id="T_8e020_row3_col7" class="data row3 col7">23109</td>
      <td id="T_8e020_row3_col8" class="data row3 col8">23580</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row4" class="row_heading level0 row4">4</th>
      <td id="T_8e020_row4_col0" class="data row4 col0">-2308</td>
      <td id="T_8e020_row4_col1" class="data row4 col1">2692</td>
      <td id="T_8e020_row4_col2" class="data row4 col2">0</td>
      <td id="T_8e020_row4_col3" class="data row4 col3">-89619</td>
      <td id="T_8e020_row4_col4" class="data row4 col4">0</td>
      <td id="T_8e020_row4_col5" class="data row4 col5">15852</td>
      <td id="T_8e020_row4_col6" class="data row4 col6">856</td>
      <td id="T_8e020_row4_col7" class="data row4 col7">26233</td>
      <td id="T_8e020_row4_col8" class="data row4 col8">27089</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row5" class="row_heading level0 row5">5</th>
      <td id="T_8e020_row5_col0" class="data row5 col0">-2240</td>
      <td id="T_8e020_row5_col1" class="data row5 col1">2760</td>
      <td id="T_8e020_row5_col2" class="data row5 col2">0</td>
      <td id="T_8e020_row5_col3" class="data row5 col3">-86859</td>
      <td id="T_8e020_row5_col4" class="data row5 col4">0</td>
      <td id="T_8e020_row5_col5" class="data row5 col5">16296</td>
      <td id="T_8e020_row5_col6" class="data row5 col6">1368</td>
      <td id="T_8e020_row5_col7" class="data row5 col7">29436</td>
      <td id="T_8e020_row5_col8" class="data row5 col8">30804</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row6" class="row_heading level0 row6">6</th>
      <td id="T_8e020_row6_col0" class="data row6 col0">-2171</td>
      <td id="T_8e020_row6_col1" class="data row6 col1">2829</td>
      <td id="T_8e020_row6_col2" class="data row6 col2">0</td>
      <td id="T_8e020_row6_col3" class="data row6 col3">-84031</td>
      <td id="T_8e020_row6_col4" class="data row6 col4">0</td>
      <td id="T_8e020_row6_col5" class="data row6 col5">16752</td>
      <td id="T_8e020_row6_col6" class="data row6 col6">2015</td>
      <td id="T_8e020_row6_col7" class="data row6 col7">32721</td>
      <td id="T_8e020_row6_col8" class="data row6 col8">34736</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row7" class="row_heading level0 row7">7</th>
      <td id="T_8e020_row7_col0" class="data row7 col0">-2101</td>
      <td id="T_8e020_row7_col1" class="data row7 col1">2899</td>
      <td id="T_8e020_row7_col2" class="data row7 col2">0</td>
      <td id="T_8e020_row7_col3" class="data row7 col3">-81131</td>
      <td id="T_8e020_row7_col4" class="data row7 col4">0</td>
      <td id="T_8e020_row7_col5" class="data row7 col5">17221</td>
      <td id="T_8e020_row7_col6" class="data row7 col6">2805</td>
      <td id="T_8e020_row7_col7" class="data row7 col7">36090</td>
      <td id="T_8e020_row7_col8" class="data row7 col8">38895</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row8" class="row_heading level0 row8">8</th>
      <td id="T_8e020_row8_col0" class="data row8 col0">-2028</td>
      <td id="T_8e020_row8_col1" class="data row8 col1">2972</td>
      <td id="T_8e020_row8_col2" class="data row8 col2">0</td>
      <td id="T_8e020_row8_col3" class="data row8 col3">-78160</td>
      <td id="T_8e020_row8_col4" class="data row8 col4">0</td>
      <td id="T_8e020_row8_col5" class="data row8 col5">17703</td>
      <td id="T_8e020_row8_col6" class="data row8 col6">3749</td>
      <td id="T_8e020_row8_col7" class="data row8 col7">39543</td>
      <td id="T_8e020_row8_col8" class="data row8 col8">43293</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row9" class="row_heading level0 row9">9</th>
      <td id="T_8e020_row9_col0" class="data row9 col0">-1954</td>
      <td id="T_8e020_row9_col1" class="data row9 col1">3046</td>
      <td id="T_8e020_row9_col2" class="data row9 col2">0</td>
      <td id="T_8e020_row9_col3" class="data row9 col3">-75114</td>
      <td id="T_8e020_row9_col4" class="data row9 col4">0</td>
      <td id="T_8e020_row9_col5" class="data row9 col5">18199</td>
      <td id="T_8e020_row9_col6" class="data row9 col6">4855</td>
      <td id="T_8e020_row9_col7" class="data row9 col7">43085</td>
      <td id="T_8e020_row9_col8" class="data row9 col8">47940</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row10" class="row_heading level0 row10">10</th>
      <td id="T_8e020_row10_col0" class="data row10 col0">-1878</td>
      <td id="T_8e020_row10_col1" class="data row10 col1">3122</td>
      <td id="T_8e020_row10_col2" class="data row10 col2">0</td>
      <td id="T_8e020_row10_col3" class="data row10 col3">-71992</td>
      <td id="T_8e020_row10_col4" class="data row10 col4">0</td>
      <td id="T_8e020_row10_col5" class="data row10 col5">18708</td>
      <td id="T_8e020_row10_col6" class="data row10 col6">6134</td>
      <td id="T_8e020_row10_col7" class="data row10 col7">46717</td>
      <td id="T_8e020_row10_col8" class="data row10 col8">52851</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row11" class="row_heading level0 row11">11</th>
      <td id="T_8e020_row11_col0" class="data row11 col0">-1800</td>
      <td id="T_8e020_row11_col1" class="data row11 col1">3200</td>
      <td id="T_8e020_row11_col2" class="data row11 col2">0</td>
      <td id="T_8e020_row11_col3" class="data row11 col3">-68791</td>
      <td id="T_8e020_row11_col4" class="data row11 col4">0</td>
      <td id="T_8e020_row11_col5" class="data row11 col5">19232</td>
      <td id="T_8e020_row11_col6" class="data row11 col6">7595</td>
      <td id="T_8e020_row11_col7" class="data row11 col7">50441</td>
      <td id="T_8e020_row11_col8" class="data row11 col8">58036</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row12" class="row_heading level0 row12">12</th>
      <td id="T_8e020_row12_col0" class="data row12 col0">-1720</td>
      <td id="T_8e020_row12_col1" class="data row12 col1">3280</td>
      <td id="T_8e020_row12_col2" class="data row12 col2">0</td>
      <td id="T_8e020_row12_col3" class="data row12 col3">-65511</td>
      <td id="T_8e020_row12_col4" class="data row12 col4">0</td>
      <td id="T_8e020_row12_col5" class="data row12 col5">19771</td>
      <td id="T_8e020_row12_col6" class="data row12 col6">9251</td>
      <td id="T_8e020_row12_col7" class="data row12 col7">54260</td>
      <td id="T_8e020_row12_col8" class="data row12 col8">63511</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row13" class="row_heading level0 row13">13</th>
      <td id="T_8e020_row13_col0" class="data row13 col0">-1638</td>
      <td id="T_8e020_row13_col1" class="data row13 col1">3362</td>
      <td id="T_8e020_row13_col2" class="data row13 col2">0</td>
      <td id="T_8e020_row13_col3" class="data row13 col3">-62149</td>
      <td id="T_8e020_row13_col4" class="data row13 col4">0</td>
      <td id="T_8e020_row13_col5" class="data row13 col5">20324</td>
      <td id="T_8e020_row13_col6" class="data row13 col6">11113</td>
      <td id="T_8e020_row13_col7" class="data row13 col7">58175</td>
      <td id="T_8e020_row13_col8" class="data row13 col8">69289</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row14" class="row_heading level0 row14">14</th>
      <td id="T_8e020_row14_col0" class="data row14 col0">-1554</td>
      <td id="T_8e020_row14_col1" class="data row14 col1">3446</td>
      <td id="T_8e020_row14_col2" class="data row14 col2">0</td>
      <td id="T_8e020_row14_col3" class="data row14 col3">-58703</td>
      <td id="T_8e020_row14_col4" class="data row14 col4">0</td>
      <td id="T_8e020_row14_col5" class="data row14 col5">20893</td>
      <td id="T_8e020_row14_col6" class="data row14 col6">13194</td>
      <td id="T_8e020_row14_col7" class="data row14 col7">62191</td>
      <td id="T_8e020_row14_col8" class="data row14 col8">75384</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row15" class="row_heading level0 row15">15</th>
      <td id="T_8e020_row15_col0" class="data row15 col0">-1468</td>
      <td id="T_8e020_row15_col1" class="data row15 col1">3532</td>
      <td id="T_8e020_row15_col2" class="data row15 col2">0</td>
      <td id="T_8e020_row15_col3" class="data row15 col3">-55170</td>
      <td id="T_8e020_row15_col4" class="data row15 col4">0</td>
      <td id="T_8e020_row15_col5" class="data row15 col5">21478</td>
      <td id="T_8e020_row15_col6" class="data row15 col6">15505</td>
      <td id="T_8e020_row15_col7" class="data row15 col7">66308</td>
      <td id="T_8e020_row15_col8" class="data row15 col8">81813</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row16" class="row_heading level0 row16">16</th>
      <td id="T_8e020_row16_col0" class="data row16 col0">-1379</td>
      <td id="T_8e020_row16_col1" class="data row16 col1">3621</td>
      <td id="T_8e020_row16_col2" class="data row16 col2">0</td>
      <td id="T_8e020_row16_col3" class="data row16 col3">-51549</td>
      <td id="T_8e020_row16_col4" class="data row16 col4">0</td>
      <td id="T_8e020_row16_col5" class="data row16 col5">22080</td>
      <td id="T_8e020_row16_col6" class="data row16 col6">18062</td>
      <td id="T_8e020_row16_col7" class="data row16 col7">70530</td>
      <td id="T_8e020_row16_col8" class="data row16 col8">88592</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row17" class="row_heading level0 row17">17</th>
      <td id="T_8e020_row17_col0" class="data row17 col0">-1289</td>
      <td id="T_8e020_row17_col1" class="data row17 col1">3711</td>
      <td id="T_8e020_row17_col2" class="data row17 col2">0</td>
      <td id="T_8e020_row17_col3" class="data row17 col3">-47838</td>
      <td id="T_8e020_row17_col4" class="data row17 col4">0</td>
      <td id="T_8e020_row17_col5" class="data row17 col5">22698</td>
      <td id="T_8e020_row17_col6" class="data row17 col6">20877</td>
      <td id="T_8e020_row17_col7" class="data row17 col7">74860</td>
      <td id="T_8e020_row17_col8" class="data row17 col8">95737</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row18" class="row_heading level0 row18">18</th>
      <td id="T_8e020_row18_col0" class="data row18 col0">-1196</td>
      <td id="T_8e020_row18_col1" class="data row18 col1">3804</td>
      <td id="T_8e020_row18_col2" class="data row18 col2">0</td>
      <td id="T_8e020_row18_col3" class="data row18 col3">-44034</td>
      <td id="T_8e020_row18_col4" class="data row18 col4">0</td>
      <td id="T_8e020_row18_col5" class="data row18 col5">23334</td>
      <td id="T_8e020_row18_col6" class="data row18 col6">23967</td>
      <td id="T_8e020_row18_col7" class="data row18 col7">79299</td>
      <td id="T_8e020_row18_col8" class="data row18 col8">103267</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row19" class="row_heading level0 row19">19</th>
      <td id="T_8e020_row19_col0" class="data row19 col0">-1101</td>
      <td id="T_8e020_row19_col1" class="data row19 col1">3899</td>
      <td id="T_8e020_row19_col2" class="data row19 col2">0</td>
      <td id="T_8e020_row19_col3" class="data row19 col3">-40135</td>
      <td id="T_8e020_row19_col4" class="data row19 col4">0</td>
      <td id="T_8e020_row19_col5" class="data row19 col5">23987</td>
      <td id="T_8e020_row19_col6" class="data row19 col6">27347</td>
      <td id="T_8e020_row19_col7" class="data row19 col7">83852</td>
      <td id="T_8e020_row19_col8" class="data row19 col8">111199</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row20" class="row_heading level0 row20">20</th>
      <td id="T_8e020_row20_col0" class="data row20 col0">-1003</td>
      <td id="T_8e020_row20_col1" class="data row20 col1">3997</td>
      <td id="T_8e020_row20_col2" class="data row20 col2">0</td>
      <td id="T_8e020_row20_col3" class="data row20 col3">-36138</td>
      <td id="T_8e020_row20_col4" class="data row20 col4">0</td>
      <td id="T_8e020_row20_col5" class="data row20 col5">24659</td>
      <td id="T_8e020_row20_col6" class="data row20 col6">31033</td>
      <td id="T_8e020_row20_col7" class="data row20 col7">88520</td>
      <td id="T_8e020_row20_col8" class="data row20 col8">119554</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row21" class="row_heading level0 row21">21</th>
      <td id="T_8e020_row21_col0" class="data row21 col0">-903</td>
      <td id="T_8e020_row21_col1" class="data row21 col1">4097</td>
      <td id="T_8e020_row21_col2" class="data row21 col2">0</td>
      <td id="T_8e020_row21_col3" class="data row21 col3">-32042</td>
      <td id="T_8e020_row21_col4" class="data row21 col4">0</td>
      <td id="T_8e020_row21_col5" class="data row21 col5">25349</td>
      <td id="T_8e020_row21_col6" class="data row21 col6">35044</td>
      <td id="T_8e020_row21_col7" class="data row21 col7">93307</td>
      <td id="T_8e020_row21_col8" class="data row21 col8">128351</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row22" class="row_heading level0 row22">22</th>
      <td id="T_8e020_row22_col0" class="data row22 col0">-801</td>
      <td id="T_8e020_row22_col1" class="data row22 col1">4199</td>
      <td id="T_8e020_row22_col2" class="data row22 col2">0</td>
      <td id="T_8e020_row22_col3" class="data row22 col3">-27843</td>
      <td id="T_8e020_row22_col4" class="data row22 col4">0</td>
      <td id="T_8e020_row22_col5" class="data row22 col5">26059</td>
      <td id="T_8e020_row22_col6" class="data row22 col6">39396</td>
      <td id="T_8e020_row22_col7" class="data row22 col7">98216</td>
      <td id="T_8e020_row22_col8" class="data row22 col8">137612</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row23" class="row_heading level0 row23">23</th>
      <td id="T_8e020_row23_col0" class="data row23 col0">-696</td>
      <td id="T_8e020_row23_col1" class="data row23 col1">4304</td>
      <td id="T_8e020_row23_col2" class="data row23 col2">0</td>
      <td id="T_8e020_row23_col3" class="data row23 col3">-23539</td>
      <td id="T_8e020_row23_col4" class="data row23 col4">0</td>
      <td id="T_8e020_row23_col5" class="data row23 col5">26788</td>
      <td id="T_8e020_row23_col6" class="data row23 col6">44110</td>
      <td id="T_8e020_row23_col7" class="data row23 col7">103249</td>
      <td id="T_8e020_row23_col8" class="data row23 col8">147360</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row24" class="row_heading level0 row24">24</th>
      <td id="T_8e020_row24_col0" class="data row24 col0">-588</td>
      <td id="T_8e020_row24_col1" class="data row24 col1">4412</td>
      <td id="T_8e020_row24_col2" class="data row24 col2">0</td>
      <td id="T_8e020_row24_col3" class="data row24 col3">-19127</td>
      <td id="T_8e020_row24_col4" class="data row24 col4">0</td>
      <td id="T_8e020_row24_col5" class="data row24 col5">27538</td>
      <td id="T_8e020_row24_col6" class="data row24 col6">49206</td>
      <td id="T_8e020_row24_col7" class="data row24 col7">108411</td>
      <td id="T_8e020_row24_col8" class="data row24 col8">157617</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row25" class="row_heading level0 row25">25</th>
      <td id="T_8e020_row25_col0" class="data row25 col0">-478</td>
      <td id="T_8e020_row25_col1" class="data row25 col1">4522</td>
      <td id="T_8e020_row25_col2" class="data row25 col2">0</td>
      <td id="T_8e020_row25_col3" class="data row25 col3">-14606</td>
      <td id="T_8e020_row25_col4" class="data row25 col4">0</td>
      <td id="T_8e020_row25_col5" class="data row25 col5">28310</td>
      <td id="T_8e020_row25_col6" class="data row25 col6">54704</td>
      <td id="T_8e020_row25_col7" class="data row25 col7">113704</td>
      <td id="T_8e020_row25_col8" class="data row25 col8">168408</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row26" class="row_heading level0 row26">26</th>
      <td id="T_8e020_row26_col0" class="data row26 col0">-365</td>
      <td id="T_8e020_row26_col1" class="data row26 col1">4635</td>
      <td id="T_8e020_row26_col2" class="data row26 col2">0</td>
      <td id="T_8e020_row26_col3" class="data row26 col3">-9971</td>
      <td id="T_8e020_row26_col4" class="data row26 col4">0</td>
      <td id="T_8e020_row26_col5" class="data row26 col5">29102</td>
      <td id="T_8e020_row26_col6" class="data row26 col6">60627</td>
      <td id="T_8e020_row26_col7" class="data row26 col7">119131</td>
      <td id="T_8e020_row26_col8" class="data row26 col8">179759</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row27" class="row_heading level0 row27">27</th>
      <td id="T_8e020_row27_col0" class="data row27 col0">-249</td>
      <td id="T_8e020_row27_col1" class="data row27 col1">4751</td>
      <td id="T_8e020_row27_col2" class="data row27 col2">0</td>
      <td id="T_8e020_row27_col3" class="data row27 col3">-5220</td>
      <td id="T_8e020_row27_col4" class="data row27 col4">0</td>
      <td id="T_8e020_row27_col5" class="data row27 col5">29917</td>
      <td id="T_8e020_row27_col6" class="data row27 col6">66999</td>
      <td id="T_8e020_row27_col7" class="data row27 col7">124697</td>
      <td id="T_8e020_row27_col8" class="data row27 col8">191696</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row28" class="row_heading level0 row28">28</th>
      <td id="T_8e020_row28_col0" class="data row28 col0">-130</td>
      <td id="T_8e020_row28_col1" class="data row28 col1">4870</td>
      <td id="T_8e020_row28_col2" class="data row28 col2">0</td>
      <td id="T_8e020_row28_col3" class="data row28 col3">-350</td>
      <td id="T_8e020_row28_col4" class="data row28 col4">0</td>
      <td id="T_8e020_row28_col5" class="data row28 col5">30755</td>
      <td id="T_8e020_row28_col6" class="data row28 col6">73843</td>
      <td id="T_8e020_row28_col7" class="data row28 col7">130404</td>
      <td id="T_8e020_row28_col8" class="data row28 col8">204247</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row29" class="row_heading level0 row29">29</th>
      <td id="T_8e020_row29_col0" class="data row29 col0">-9</td>
      <td id="T_8e020_row29_col1" class="data row29 col1">350</td>
      <td id="T_8e020_row29_col2" class="data row29 col2">0</td>
      <td id="T_8e020_row29_col3" class="data row29 col3">0</td>
      <td id="T_8e020_row29_col4" class="data row29 col4">4641</td>
      <td id="T_8e020_row29_col5" class="data row29 col5">36257</td>
      <td id="T_8e020_row29_col6" class="data row29 col6">77584</td>
      <td id="T_8e020_row29_col7" class="data row29 col7">136257</td>
      <td id="T_8e020_row29_col8" class="data row29 col8">213841</td>
    </tr>
    <tr>
      <th id="T_8e020_level0_row30" class="row_heading level0 row30">Total:</th>
      <td id="T_8e020_row30_col0" class="data row30 col0">-40359</td>
      <td id="T_8e020_row30_col1" class="data row30 col1">100000</td>
      <td id="T_8e020_row30_col2" class="data row30 col2">0</td>
      <td id="T_8e020_row30_col3" class="data row30 col3">0</td>
      <td id="T_8e020_row30_col4" class="data row30 col4">19641</td>
      <td id="T_8e020_row30_col5" class="data row30 col5">36257</td>
      <td id="T_8e020_row30_col6" class="data row30 col6">77584</td>
      <td id="T_8e020_row30_col7" class="data row30 col7">136257</td>
      <td id="T_8e020_row30_col8" class="data row30 col8">213841</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</section>
<section id="resources" class="level1">
<h1>Resources</h1>
<section id="interactive-notebook" class="level2">
<h2 class="anchored" data-anchor-id="interactive-notebook">Interactive notebook</h2>
<ul>
<li>Play with the numbers: <a href="https://colab.research.google.com/github/joatom/blog/blob/master/assets/resources/notebooks/2022-11-13-repay-vs-invest.ipynb"><img src="https://joatom.github.io/blog/assets/colab.svg?sanitize=true'" class="img-fluid" alt="notebook"></a></li>
<li>Downloading the notebook: <a href="https://github.com/joatom/blog/blob/master/assets/resources/notebooks/2022-11-13-repay-vs-invest.ipynb"><img src="https://joatom.github.io/blog/assets/github.svg?sanitize=true'" class="img-fluid" alt="notebook"></a>)</li>
</ul>
</section>
<section id="related-blog" class="level2">
<h2 class="anchored" data-anchor-id="related-blog">Related Blog</h2>
<ul>
<li><a href="../../posts/2022-11-13-repay-vs-invest/index.html">Pay off Mortgage or Invest</a></li>
</ul>


</section>
</section>

 ]]></description>
  <category>Pandas</category>
  <category>Layout</category>
  <guid>https://joatom.github.io/blog/snippets/2022-11-20-pandas-styles/index.html</guid>
  <pubDate>Sat, 19 Nov 2022 23:00:00 GMT</pubDate>
  <media:content url="https://joatom.github.io/blog/assets/colab.svg?sanitize=true&#39;" medium="image"/>
</item>
<item>
  <title>Recursive SQL</title>
  <dc:creator>Johannes Tomasoni</dc:creator>
  <link>https://joatom.github.io/blog/snippets/2022-11-20-recursive-sql/index.html</link>
  <description><![CDATA[ 




<div class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="op" style="color: #5E5E5E;">!</span>sqlite3 fin.db .databases .quit</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>main: /home/git_repos/blog/snippets/2022-11-20-recursive-sql/fin.db r/w</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;">import</span> sqlite3</span>
<span id="cb3-2"><span class="im" style="color: #00769E;">import</span> sqlalchemy</span></code></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;"># enable sql magic for Jupyter notebook</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;"># load jupyter extention (requires pip install ipython-sql)</span></span>
<span id="cb4-4"><span class="op" style="color: #5E5E5E;">%</span>load_ext sql</span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;"># disable autocommit</span></span>
<span id="cb4-6"><span class="op" style="color: #5E5E5E;">%</span>config SqlMagic.autocommit<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">False</span></span></code></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="op" style="color: #5E5E5E;">%</span>sql sqlite:<span class="op" style="color: #5E5E5E;">///</span>rec.db</span>
<span id="cb5-2">    </span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;"># Test connection</span></span>
<span id="cb5-4">v1 <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Ready to go!"</span></span>
<span id="cb5-5"><span class="op" style="color: #5E5E5E;">%</span>sql df_test <span class="op" style="color: #5E5E5E;">&lt;&lt;</span> SELECT :v1 <span class="im" style="color: #00769E;">as</span> <span class="st" style="color: #20794D;">"Test"</span></span>
<span id="cb5-6"><span class="cf" style="color: #003B4F;">assert</span>(df_test.DataFrame().values[<span class="dv" style="color: #AD0000;">0</span>]<span class="op" style="color: #5E5E5E;">==</span>v1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///rec.db
Done.
Returning data to local variable df_test</code></pre>
</div>
</div>
<section id="running-a-recursive-query" class="level1">
<h1>Running a recursive query</h1>
<p>This is an example from the blog post <a href="../../posts/2022-11-13-repay-vs-invest/index.html">Pay off Mortgage or Invest</a>. It calculates a simple amortization plan. The recursion stops as soon as the balance reaches <em>0</em>.</p>
<div class="cell" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="op" style="color: #5E5E5E;">%%</span>sql</span>
<span id="cb7-2"><span class="cf" style="color: #003B4F;">with</span> plan(year, interest, principal, balance) <span class="im" style="color: #00769E;">as</span></span>
<span id="cb7-3">(</span>
<span id="cb7-4">    SELECT <span class="dv" style="color: #AD0000;">0</span> AS year,</span>
<span id="cb7-5">           NULL AS interest,</span>
<span id="cb7-6">           NULL AS principal,</span>
<span id="cb7-7">           <span class="dv" style="color: #AD0000;">100000</span> AS balance</span>
<span id="cb7-8">    UNION</span>
<span id="cb7-9">    SELECT p.year <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span> AS year,</span>
<span id="cb7-10">           <span class="op" style="color: #5E5E5E;">-</span>p.balance <span class="op" style="color: #5E5E5E;">*</span> <span class="fl" style="color: #AD0000;">0.02</span> AS interest,</span>
<span id="cb7-11">           MIN(<span class="dv" style="color: #AD0000;">10000</span> <span class="op" style="color: #5E5E5E;">-</span> p.balance <span class="op" style="color: #5E5E5E;">*</span> <span class="fl" style="color: #AD0000;">0.02</span>, p.balance) AS principal,</span>
<span id="cb7-12">           p.balance <span class="op" style="color: #5E5E5E;">-</span> (<span class="bu" style="color: null;">min</span>(<span class="dv" style="color: #AD0000;">10000</span> <span class="op" style="color: #5E5E5E;">-</span> p.balance <span class="op" style="color: #5E5E5E;">*</span> <span class="fl" style="color: #AD0000;">0.02</span>, p.balance)) AS balance</span>
<span id="cb7-13">      FROM plan p</span>
<span id="cb7-14">     WHERE p.balance <span class="op" style="color: #5E5E5E;">-</span> (<span class="bu" style="color: null;">min</span>(<span class="dv" style="color: #AD0000;">10000</span> <span class="op" style="color: #5E5E5E;">-</span> p.balance <span class="op" style="color: #5E5E5E;">*</span> <span class="fl" style="color: #AD0000;">0.02</span>, p.balance) <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">0</span>) <span class="op" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">0</span> </span>
<span id="cb7-15">       AND MIN(<span class="dv" style="color: #AD0000;">10000</span> <span class="op" style="color: #5E5E5E;">-</span> p.balance <span class="op" style="color: #5E5E5E;">*</span> <span class="fl" style="color: #AD0000;">0.02</span>, p.balance) <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="dv" style="color: #AD0000;">0</span> </span>
<span id="cb7-16">)</span>
<span id="cb7-17">SELECT year,</span>
<span id="cb7-18">       <span class="bu" style="color: null;">round</span>(interest) AS interest, </span>
<span id="cb7-19">       <span class="bu" style="color: null;">round</span>(principal) AS principal,  </span>
<span id="cb7-20">       <span class="bu" style="color: null;">round</span>(<span class="op" style="color: #5E5E5E;">-</span>balance) AS balance</span>
<span id="cb7-21">  FROM plan</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///rec.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">

<table>
    <tbody><tr>
        <th>year</th>
        <th>interest</th>
        <th>principal</th>
        <th>balance</th>
    </tr>
    <tr>
        <td>0</td>
        <td>None</td>
        <td>None</td>
        <td>-100000.0</td>
    </tr>
    <tr>
        <td>1</td>
        <td>-2000.0</td>
        <td>8000.0</td>
        <td>-92000.0</td>
    </tr>
    <tr>
        <td>2</td>
        <td>-1840.0</td>
        <td>8160.0</td>
        <td>-83840.0</td>
    </tr>
    <tr>
        <td>3</td>
        <td>-1677.0</td>
        <td>8323.0</td>
        <td>-75517.0</td>
    </tr>
    <tr>
        <td>4</td>
        <td>-1510.0</td>
        <td>8490.0</td>
        <td>-67027.0</td>
    </tr>
    <tr>
        <td>5</td>
        <td>-1341.0</td>
        <td>8659.0</td>
        <td>-58368.0</td>
    </tr>
    <tr>
        <td>6</td>
        <td>-1167.0</td>
        <td>8833.0</td>
        <td>-49535.0</td>
    </tr>
    <tr>
        <td>7</td>
        <td>-991.0</td>
        <td>9009.0</td>
        <td>-40526.0</td>
    </tr>
    <tr>
        <td>8</td>
        <td>-811.0</td>
        <td>9189.0</td>
        <td>-31336.0</td>
    </tr>
    <tr>
        <td>9</td>
        <td>-627.0</td>
        <td>9373.0</td>
        <td>-21963.0</td>
    </tr>
    <tr>
        <td>10</td>
        <td>-439.0</td>
        <td>9561.0</td>
        <td>-12402.0</td>
    </tr>
    <tr>
        <td>11</td>
        <td>-248.0</td>
        <td>9752.0</td>
        <td>-2650.0</td>
    </tr>
    <tr>
        <td>12</td>
        <td>-53.0</td>
        <td>2650.0</td>
        <td>0.0</td>
    </tr>
</tbody></table>
</div>
</div>
</section>
<section id="ressources" class="level1">
<h1>Ressources</h1>
<section id="interactive-notebook" class="level2">
<h2 class="anchored" data-anchor-id="interactive-notebook">Interactive notebook</h2>
<ul>
<li>Play with the numbers: <a href="https://colab.research.google.com/github/joatom/blog/blob/master/docs/snippets/2022-11-20-recursive-sql/index.ipynb"><img src="https://joatom.github.io/blog/assets/colab.svg?sanitize=true'" class="img-fluid" alt="notebook"></a></li>
<li>Downloading the notebook: <a href="https://colab.research.google.com/github/joatom/blog/blob/master/docs/snippets/2022-11-20-recursive-sql/index.ipynb"><img src="https://joatom.github.io/blog/assets/github.svg?sanitize=true'" class="img-fluid" alt="notebook"></a></li>
</ul>
</section>
<section id="related-blog" class="level2">
<h2 class="anchored" data-anchor-id="related-blog">Related Blog</h2>
<ul>
<li><a href="../../posts/2022-11-13-repay-vs-invest/index.html">Pay off Mortgage or Invest</a></li>
</ul>


</section>
</section>

 ]]></description>
  <category>SQL</category>
  <category>Sqlite</category>
  <category>Oracle</category>
  <category>SQL Magic</category>
  <guid>https://joatom.github.io/blog/snippets/2022-11-20-recursive-sql/index.html</guid>
  <pubDate>Sat, 19 Nov 2022 23:00:00 GMT</pubDate>
  <media:content url="https://joatom.github.io/blog/assets/colab.svg?sanitize=true&#39;" medium="image"/>
</item>
<item>
  <title>Melt &amp; pivot</title>
  <dc:creator>Johannes Tomasoni</dc:creator>
  <link>https://joatom.github.io/blog/snippets/2022-11-11-melt/2022-11-11-melt.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>date</th>
      <th>fruit</th>
      <th>amount</th>
      <th>quality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2022-09-01</td>
      <td>apple (red)</td>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022-09-01</td>
      <td>grape (red)</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2022-09-01</td>
      <td>grape (white)</td>
      <td>6</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2022-09-03</td>
      <td>grape (red)</td>
      <td>6</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2022-09-03</td>
      <td>grape (white)</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2022-09-04</td>
      <td>apple (red)</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2022-09-04</td>
      <td>grape (white)</td>
      <td>9</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2022-09-05</td>
      <td>apple (red)</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2022-09-05</td>
      <td>grape (red)</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2022-09-05</td>
      <td>grape (white)</td>
      <td>8</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="pivot" class="level1">
<h1>Pivot</h1>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1">data_pv <span class="op" style="color: #5E5E5E;">=</span> data.pivot(index<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'date'</span>, columns<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'fruit'</span>, </span>
<span id="cb1-2">                     values<span class="op" style="color: #5E5E5E;">=</span>[<span class="st" style="color: #20794D;">'amount'</span>,<span class="st" style="color: #20794D;">'quality'</span>]).reset_index()</span>
<span id="cb1-3">data_pv</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>date</th>
      <th colspan="3" halign="left">amount</th>
      <th colspan="3" halign="left">quality</th>
    </tr>
    <tr>
      <th>fruit</th>
      <th></th>
      <th>apple (red)</th>
      <th>grape (red)</th>
      <th>grape (white)</th>
      <th>apple (red)</th>
      <th>grape (red)</th>
      <th>grape (white)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2022-09-01</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022-09-03</td>
      <td>NaN</td>
      <td>6.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2022-09-04</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>9.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2022-09-05</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>8.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="melt-unpivot" class="level1">
<h1>Melt (Unpivot)</h1>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">data_pv.columns <span class="op" style="color: #5E5E5E;">=</span> [<span class="st" style="color: #20794D;">'date'</span>, <span class="st" style="color: #20794D;">'apple (red)_amt'</span>, <span class="st" style="color: #20794D;">'grape (red)_amt'</span>,</span>
<span id="cb2-2">                   <span class="st" style="color: #20794D;">'grape (white)_amt'</span>,<span class="st" style="color: #20794D;">'apple (red)_qlt'</span>,</span>
<span id="cb2-3">                   <span class="st" style="color: #20794D;">'grape (red)_qlt'</span>,<span class="st" style="color: #20794D;">'grape (white)_qlt'</span>]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">data_pv.melt(id_vars<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'date'</span>, value_vars<span class="op" style="color: #5E5E5E;">=</span>[<span class="st" style="color: #20794D;">'apple (red)_amt'</span>, </span>
<span id="cb3-2">                                         <span class="st" style="color: #20794D;">'grape (red)_amt'</span>,</span>
<span id="cb3-3">                                         <span class="st" style="color: #20794D;">'grape (white)_amt'</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>date</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2022-09-01</td>
      <td>apple (red)_amt</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022-09-03</td>
      <td>apple (red)_amt</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2022-09-04</td>
      <td>apple (red)_amt</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2022-09-05</td>
      <td>apple (red)_amt</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2022-09-01</td>
      <td>grape (red)_amt</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2022-09-03</td>
      <td>grape (red)_amt</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2022-09-04</td>
      <td>grape (red)_amt</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2022-09-05</td>
      <td>grape (red)_amt</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2022-09-01</td>
      <td>grape (white)_amt</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2022-09-03</td>
      <td>grape (white)_amt</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2022-09-04</td>
      <td>grape (white)_amt</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2022-09-05</td>
      <td>grape (white)_amt</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>Pandas</category>
  <category>Python</category>
  <guid>https://joatom.github.io/blog/snippets/2022-11-11-melt/2022-11-11-melt.html</guid>
  <pubDate>Thu, 10 Nov 2022 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Un/pivot</title>
  <dc:creator>Johannes Tomasoni</dc:creator>
  <link>https://joatom.github.io/blog/snippets/2022-11-09-unpivot/index.html</link>
  <description><![CDATA[ 




<section id="pivot" class="level1">
<h1>Pivot</h1>
<table class="table">
<caption>HARVEST AMOUNT</caption>
<thead>
<tr class="header">
<th>DATE</th>
<th>FRUIT</th>
<th style="text-align: center;">AMOUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-09-01</td>
<td>Grape_red</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td>2022-09-01</td>
<td>Grape_red</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td>2022-09-01</td>
<td>Grape_white</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td>2022-09-01</td>
<td>Apple_red</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td>2022-09-03</td>
<td>Grape_red</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td>2022-09-03</td>
<td>Grape_white</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td>2022-09-04</td>
<td>Grape_white</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td>2022-09-04</td>
<td>Apple_red</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td>2022-09-05</td>
<td>Grape_red</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td>2022-09-05</td>
<td>Grape_white</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="odd">
<td>2022-09-05</td>
<td>Apple_red</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">PIVOT clause</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">AGG-CASE block</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb1-2">  <span class="kw" style="color: #003B4F;">FROM</span> harvest_amount</span>
<span id="cb1-3"> PIVOT(<span class="fu" style="color: #4758AB;">SUM</span>(amount) <span class="kw" style="color: #003B4F;">AS</span> amt </span>
<span id="cb1-4">       <span class="cf" style="color: #003B4F;">FOR</span> fruit <span class="kw" style="color: #003B4F;">IN</span> (<span class="st" style="color: #20794D;">'Grape_red'</span> <span class="kw" style="color: #003B4F;">AS</span> grape_red, </span>
<span id="cb1-5">                     <span class="st" style="color: #20794D;">'Grape_white'</span> <span class="kw" style="color: #003B4F;">AS</span> grape_white, </span>
<span id="cb1-6">                     <span class="st" style="color: #20794D;">'Apple_red'</span> <span class="kw" style="color: #003B4F;">AS</span> apple_red);</span>
<span id="cb1-7">);</span></code></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><span class="kw" style="color: #003B4F;">SELECT</span> h.<span class="dt" style="color: #AD0000;">date</span>,</span>
<span id="cb2-2">       <span class="fu" style="color: #4758AB;">SUM</span>(<span class="cf" style="color: #003B4F;">CASE</span> <span class="cf" style="color: #003B4F;">WHEN</span> h.fruit <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Grape_red'</span> <span class="cf" style="color: #003B4F;">THEN</span> </span>
<span id="cb2-3">                    h.amount </span>
<span id="cb2-4">                <span class="cf" style="color: #003B4F;">ELSE</span> </span>
<span id="cb2-5">                    <span class="dv" style="color: #AD0000;">0</span> </span>
<span id="cb2-6">            <span class="cf" style="color: #003B4F;">END</span>) <span class="kw" style="color: #003B4F;">AS</span> grape_red_amt,</span>
<span id="cb2-7">       <span class="fu" style="color: #4758AB;">SUM</span>(<span class="cf" style="color: #003B4F;">CASE</span> <span class="cf" style="color: #003B4F;">WHEN</span> h.fruit <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Grape_white'</span> <span class="cf" style="color: #003B4F;">THEN</span> </span>
<span id="cb2-8">                    h.amount </span>
<span id="cb2-9">                <span class="cf" style="color: #003B4F;">ELSE</span> </span>
<span id="cb2-10">                    <span class="dv" style="color: #AD0000;">0</span> </span>
<span id="cb2-11">            <span class="cf" style="color: #003B4F;">END</span>) <span class="kw" style="color: #003B4F;">AS</span> grape_white_amt,</span>
<span id="cb2-12">       <span class="fu" style="color: #4758AB;">SUM</span>(<span class="cf" style="color: #003B4F;">CASE</span> <span class="cf" style="color: #003B4F;">WHEN</span> h.fruit <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Apple_red'</span> <span class="cf" style="color: #003B4F;">THEN</span> </span>
<span id="cb2-13">                    h.amount </span>
<span id="cb2-14">                <span class="cf" style="color: #003B4F;">ELSE</span> </span>
<span id="cb2-15">                    <span class="dv" style="color: #AD0000;">0</span> </span>
<span id="cb2-16">            <span class="cf" style="color: #003B4F;">END</span>) <span class="kw" style="color: #003B4F;">AS</span> apple_red_amt,</span>
<span id="cb2-17">  <span class="kw" style="color: #003B4F;">FROM</span> harvest_amount h</span>
<span id="cb2-18"> <span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> h.<span class="dt" style="color: #AD0000;">date</span>;</span></code></pre></div>
</div>
</div>
</div>
<table class="table">
<caption>Pivoted table</caption>
<thead>
<tr class="header">
<th>DATE</th>
<th style="text-align: center;">GRAPE_RED_AMT</th>
<th style="text-align: center;">GRAPE_WHITE_AMT</th>
<th style="text-align: center;">APPLE_RED_AMT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-09-01</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td>2022-09-03</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>2022-09-04</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td>2022-09-04</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<section id="multiple-columns" class="level2">
<h2 class="anchored" data-anchor-id="multiple-columns">Multiple columns</h2>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb3-2">  <span class="kw" style="color: #003B4F;">FROM</span> harvest_amount</span>
<span id="cb3-3"> PIVOT(<span class="fu" style="color: #4758AB;">sum</span>(amount) <span class="kw" style="color: #003B4F;">as</span> amt, </span>
<span id="cb3-4">       <span class="fu" style="color: #4758AB;">max</span>(amount) <span class="kw" style="color: #003B4F;">as</span> max_amt </span>
<span id="cb3-5">       <span class="cf" style="color: #003B4F;">FOR</span> fruit <span class="kw" style="color: #003B4F;">IN</span> (<span class="st" style="color: #20794D;">'Grape_red'</span>, <span class="st" style="color: #20794D;">'Grape_white'</span>, <span class="st" style="color: #20794D;">'Apple_red'</span>);</span>
<span id="cb3-6">);</span></code></pre></div>
</section>
</section>
<section id="unpivot" class="level1">
<h1>Unpivot</h1>
<table class="table">
<caption>HARVEST AMOUNT</caption>
<thead>
<tr class="header">
<th>DATE</th>
<th style="text-align: center;">GRAPE_RED</th>
<th style="text-align: center;">GRAPE_WHITE</th>
<th style="text-align: center;">APPLE_RED</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-09-01</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td>2022-09-03</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>2022-09-04</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td>2022-09-04</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb4-2">  <span class="kw" style="color: #003B4F;">FROM</span> harvest_amount</span>
<span id="cb4-3">UNPIVOT(amount <span class="cf" style="color: #003B4F;">FOR</span> fruit <span class="kw" style="color: #003B4F;">IN</span> (grape_red <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'Grape (red)'</span>,</span>
<span id="cb4-4">                             grape_white <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'Grape (red)'</span></span>
<span id="cb4-5">                             apple_red <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'Grape (red)'</span>);</span>
<span id="cb4-6">);</span></code></pre></div>
<table class="table">
<caption>Unpivoted table</caption>
<thead>
<tr class="header">
<th>DATE</th>
<th>FRUIT</th>
<th style="text-align: center;">AMOUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-09-01</td>
<td>Grape (red)</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td>2022-09-01</td>
<td>Grape (white)</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td>2022-09-01</td>
<td>Apple (red)</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td>2022-09-03</td>
<td>Grape (red)</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td>2022-09-03</td>
<td>Grape (white)</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td>2022-09-04</td>
<td>Grape (white)</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="odd">
<td>2022-09-04</td>
<td>Apple (red)</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td>2022-09-05</td>
<td>Grape (red)</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td>2022-09-05</td>
<td>Grape (white)</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="even">
<td>2022-09-05</td>
<td>Apple (red)</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb5-2">  <span class="kw" style="color: #003B4F;">FROM</span> harvest_amount</span>
<span id="cb5-3">UNPIVOT INCLUDE <span class="kw" style="color: #003B4F;">NULLS</span>(amount <span class="cf" style="color: #003B4F;">FOR</span> fruit <span class="kw" style="color: #003B4F;">IN</span> (grape_red <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'Grape (red)'</span>,</span>
<span id="cb5-4">                                           grape_white <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'Grape (red)'</span></span>
<span id="cb5-5">                                           apple_red <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'Grape (red)'</span>);</span>
<span id="cb5-6">);</span></code></pre></div>
<table class="table">
<caption>Unpivoted table including NULLS</caption>
<thead>
<tr class="header">
<th>DATE</th>
<th>FRUIT</th>
<th style="text-align: center;">AMOUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-09-01</td>
<td>Grape (red)</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td>2022-09-01</td>
<td>Grape (white)</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td>2022-09-01</td>
<td>Apple (red)</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td>2022-09-03</td>
<td>Grape (red)</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td>2022-09-03</td>
<td>Grape (white)</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td><strong>2022-09-03</strong></td>
<td><strong>Apple (red)</strong></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td><strong>2022-09-04</strong></td>
<td><strong>Grape (red)</strong></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>2022-09-04</td>
<td>Grape (white)</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="odd">
<td>2022-09-04</td>
<td>Apple (red)</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td>2022-09-05</td>
<td>Grape (red)</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td>2022-09-05</td>
<td>Grape (white)</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="even">
<td>2022-09-05</td>
<td>Apple (red)</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<section id="multiple-columns-1" class="level2">
<h2 class="anchored" data-anchor-id="multiple-columns-1">Multiple columns</h2>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><span class="kw" style="color: #003B4F;">SELECT</span> <span class="op" style="color: #5E5E5E;">*</span></span>
<span id="cb6-2">  <span class="kw" style="color: #003B4F;">FROM</span> harvest_amt_qlt</span>
<span id="cb6-3">UNPIVOT((amount, quality) </span>
<span id="cb6-4">        <span class="cf" style="color: #003B4F;">FOR</span> fruit <span class="kw" style="color: #003B4F;">IN</span> ((grape_red_amt, grape_red_qlt) <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'Grape (red)'</span>,</span>
<span id="cb6-5">                      (grape_white_amt, grape_white_qlt) <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'Grape (red)'</span></span>
<span id="cb6-6">                      (apple_red_amt, apple_red_qlt) <span class="kw" style="color: #003B4F;">AS</span> <span class="st" style="color: #20794D;">'Grape (red)'</span>);</span>
<span id="cb6-7">);</span></code></pre></div>
</section>
</section>
<section id="resources" class="level1">
<h1>Resources</h1>
<p>Some more detailed articles about the topic:</p>
<ul>
<li>https://oracle-base.com/articles/11g/pivot-and-unpivot-operators-11gr1</li>
<li>https://www.oracletutorial.com/oracle-basics/oracle-unpivot/</li>
<li>https://www.oracletutorial.com/oracle-basics/oracle-pivot/</li>
<li>http://www.oracle-developer.net/display.php?id=506</li>
<li>https://www.oracle.com/de/technical-resources/articles/database/sql-11g-pivot.html</li>
</ul>


</section>

 ]]></description>
  <category>SQL</category>
  <category>Oracle</category>
  <guid>https://joatom.github.io/blog/snippets/2022-11-09-unpivot/index.html</guid>
  <pubDate>Tue, 08 Nov 2022 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Partitioned Join</title>
  <dc:creator>Johannes Tomasoni</dc:creator>
  <link>https://joatom.github.io/blog/snippets/2022-11-07-partitioned-join/index.html</link>
  <description><![CDATA[ 




<section id="about" class="level1">
<h1>About</h1>
<p>Filling gaps for undefined value combinations can be tricky. It can either be implemented with a CROSS JOINS or a PARTITIONED JOIN. The advantage of a PARTITIONED JOIN is reduced complexity, due to fewer joins, and enhanced execution plan.</p>
<p>As example I explore a harvest of apples and Grapes and fill the list with zero for days where a fruit hasnt been collected.</p>
</section>
<section id="implementation" class="level1">
<h1>Implementation</h1>
<p>This query contains the harvest of three fruits over five days.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><span class="kw" style="color: #003B4F;">SELECT</span> f.name <span class="kw" style="color: #003B4F;">AS</span> fruit, </span>
<span id="cb1-2">       h.<span class="dt" style="color: #AD0000;">date</span>, </span>
<span id="cb1-3">       h.amount</span>
<span id="cb1-4">  <span class="kw" style="color: #003B4F;">FROM</span> fruit f,</span>
<span id="cb1-5">       harvest h</span>
<span id="cb1-6"> <span class="kw" style="color: #003B4F;">WHERE</span> h.fruit_id <span class="op" style="color: #5E5E5E;">=</span> f.fruit_id</span>
<span id="cb1-7"> <span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">2</span>;</span></code></pre></div>
<table class="table">
<thead>
<tr class="header">
<th>FRUIT</th>
<th>DATE</th>
<th style="text-align: center;">AMOUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Grape (red)</td>
<td>2022-09-01</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td>Grape (red)</td>
<td>2022-09-03</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td>Grape (red)</td>
<td>2022-09-05</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td>Grape (white)</td>
<td>2022-09-01</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td>Grape (white)</td>
<td>2022-09-03</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td>Grape (white)</td>
<td>2022-09-04</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="odd">
<td>Grape (white)</td>
<td>2022-09-05</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="even">
<td>Apple (red)</td>
<td>2022-09-01</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td>Apple (red)</td>
<td>2022-09-04</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="even">
<td>Apple (red)</td>
<td>2022-09-05</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<p>A <strong>PARTITIONED OUTER JOIN</strong> can be used to includes the dates without harvest for each fruit:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><span class="kw" style="color: #003B4F;">WITH</span> baskets <span class="kw" style="color: #003B4F;">as</span> (</span>
<span id="cb2-2">  <span class="kw" style="color: #003B4F;">SELECT</span> f.name <span class="kw" style="color: #003B4F;">AS</span> fruit, </span>
<span id="cb2-3">         h.<span class="dt" style="color: #AD0000;">date</span>, </span>
<span id="cb2-4">         h.amount</span>
<span id="cb2-5">    <span class="kw" style="color: #003B4F;">FROM</span> fruit f,</span>
<span id="cb2-6">         harvest h</span>
<span id="cb2-7">  <span class="kw" style="color: #003B4F;">WHERE</span> h.fruit_id <span class="op" style="color: #5E5E5E;">=</span> f.fruit_id</span>
<span id="cb2-8">)</span>
<span id="cb2-9"><span class="kw" style="color: #003B4F;">SELECT</span> b.fruit,</span>
<span id="cb2-10">       t.<span class="dt" style="color: #AD0000;">date</span>,</span>
<span id="cb2-11">       <span class="fu" style="color: #4758AB;">nvl</span>(b.amount, <span class="dv" style="color: #AD0000;">0</span>) amount</span>
<span id="cb2-12">  <span class="kw" style="color: #003B4F;">FROM</span> baskets b</span>
<span id="cb2-13"><span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> (b.fruit)</span>
<span id="cb2-14"> <span class="kw" style="color: #003B4F;">RIGHT</span> <span class="kw" style="color: #003B4F;">OUTER</span> <span class="kw" style="color: #003B4F;">JOIN</span> <span class="dt" style="color: #AD0000;">time</span> t</span>
<span id="cb2-15">    <span class="kw" style="color: #003B4F;">ON</span> (t.<span class="dt" style="color: #AD0000;">date</span> <span class="op" style="color: #5E5E5E;">=</span> b.<span class="dt" style="color: #AD0000;">date</span>)</span>
<span id="cb2-16"><span class="kw" style="color: #003B4F;">ORDER</span> <span class="kw" style="color: #003B4F;">BY</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">2</span>;</span></code></pre></div>
<table class="table">
<thead>
<tr class="header">
<th>FRUIT</th>
<th>DATE</th>
<th style="text-align: center;">AMOUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Grape (red)</td>
<td>2022-09-01</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td><strong>Grape (red)</strong></td>
<td><strong>2022-09-02</strong></td>
<td style="text-align: center;"><strong>0</strong></td>
</tr>
<tr class="odd">
<td>Grape (red)</td>
<td>2022-09-03</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td><strong>Grape (red)</strong></td>
<td><strong>2022-09-04</strong></td>
<td style="text-align: center;"><strong>0</strong></td>
</tr>
<tr class="odd">
<td>Grape (red)</td>
<td>2022-09-05</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td>Grape (white)</td>
<td>2022-09-01</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td><strong>Grape (white)</strong></td>
<td><strong>2022-09-02</strong></td>
<td style="text-align: center;"><strong>0</strong></td>
</tr>
<tr class="even">
<td>Grape (white)</td>
<td>2022-09-03</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td>Grape (white)</td>
<td>2022-09-04</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td>Grape (white)</td>
<td>2022-09-05</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="odd">
<td>Apple (red)</td>
<td>2022-09-01</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td><strong>Apple (red)</strong></td>
<td><strong>2022-09-02</strong></td>
<td style="text-align: center;"><strong>0</strong></td>
</tr>
<tr class="odd">
<td><strong>Apple (red)</strong></td>
<td><strong>2022-09-03</strong></td>
<td style="text-align: center;"><strong>0</strong></td>
</tr>
<tr class="even">
<td>Apple (red)</td>
<td>2022-09-04</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td>Apple (red)</td>
<td>2022-09-05</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>


</section>

 ]]></description>
  <category>SQL</category>
  <category>Oracle</category>
  <guid>https://joatom.github.io/blog/snippets/2022-11-07-partitioned-join/index.html</guid>
  <pubDate>Sun, 06 Nov 2022 23:00:00 GMT</pubDate>
</item>
<item>
  <title>User defined aggregation function</title>
  <dc:creator>Johannes Tomasoni</dc:creator>
  <link>https://joatom.github.io/blog/snippets/2022-11-07-udaf/index.html</link>
  <description><![CDATA[ 




<section id="about" class="level1 page-columns page-full">
<h1>About</h1>
<p>This article describes the steps to create a customized aggregation function in Oracle.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="https://latex.codecogs.com/png.latex?Recall%20=%20%5Cfrac%7BTP%7D%7BTP+FN%7D"></p>
</div></div><p>As example <em>Recall</em> is implemented.</p>
</section>
<section id="implementation" class="level1 page-columns page-full">
<h1>Implementation</h1>
<p>Define a type for the input values, if it isnt a native Oracle type (NUMBER, VARCHAR2, ) or if the aggragation function will take more than one input value.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><span class="kw" style="color: #003B4F;">CREATE</span> <span class="kw" style="color: #003B4F;">OR</span> <span class="kw" style="color: #003B4F;">REPLACE</span> <span class="kw" style="color: #003B4F;">TYPE</span> y_pair <span class="kw" style="color: #003B4F;">FORCE</span> <span class="kw" style="color: #003B4F;">AS</span> <span class="dt" style="color: #AD0000;">OBJECT</span> (</span>
<span id="cb1-2">  y_true <span class="dt" style="color: #AD0000;">NUMBER</span>, </span>
<span id="cb1-3">  y_pred <span class="dt" style="color: #AD0000;">NUMBER</span>, </span>
<span id="cb1-4">  threshold <span class="dt" style="color: #AD0000;">NUMBER</span> <span class="kw" style="color: #003B4F;">DEFAULT</span> <span class="fl" style="color: #AD0000;">0.5</span></span>
<span id="cb1-5">);</span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;">/</span></span></code></pre></div>
<p>Implement logic of user defined function in a oracle object type.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><span class="co" style="color: #5E5E5E;">-- Create type header</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;">CREATE</span> <span class="kw" style="color: #003B4F;">OR</span> <span class="kw" style="color: #003B4F;">REPLACE</span> <span class="kw" style="color: #003B4F;">TYPE</span> RecallImpl <span class="kw" style="color: #003B4F;">AS</span> <span class="dt" style="color: #AD0000;">OBJECT</span>(</span>
<span id="cb2-3">  <span class="co" style="color: #5E5E5E;">-- define object variables</span></span>
<span id="cb2-4">  tp <span class="dt" style="color: #AD0000;">NUMBER</span>, <span class="co" style="color: #5E5E5E;">-- number of true positives</span></span>
<span id="cb2-5">  fn <span class="dt" style="color: #AD0000;">NUMBER</span>, <span class="co" style="color: #5E5E5E;">-- number of false negatives</span></span>
<span id="cb2-6"></span>
<span id="cb2-7">  <span class="co" style="color: #5E5E5E;">-- Interface for Oracle userdefined functions. </span></span>
<span id="cb2-8">  <span class="co" style="color: #5E5E5E;">-- Init, iterate and terminate are mandatory</span></span>
<span id="cb2-9">  <span class="kw" style="color: #003B4F;">STATIC</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateInitialize(sctx <span class="kw" style="color: #003B4F;">IN</span> <span class="kw" style="color: #003B4F;">OUT</span> RecallImpl) <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span>,</span>
<span id="cb2-10">  <span class="kw" style="color: #003B4F;">MEMBER</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateIterate(self <span class="kw" style="color: #003B4F;">IN</span> <span class="kw" style="color: #003B4F;">OUT</span> RecallImpl, <span class="fu" style="color: #4758AB;">value</span> <span class="kw" style="color: #003B4F;">IN</span> y_pair) <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span>,</span>
<span id="cb2-11">  <span class="kw" style="color: #003B4F;">MEMBER</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateDelete(self <span class="kw" style="color: #003B4F;">IN</span> <span class="kw" style="color: #003B4F;">OUT</span> RecallImpl, <span class="fu" style="color: #4758AB;">value</span> <span class="kw" style="color: #003B4F;">IN</span> y_pair) <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span>,</span>
<span id="cb2-12">  <span class="kw" style="color: #003B4F;">MEMBER</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateTerminate(self <span class="kw" style="color: #003B4F;">IN</span> RecallImpl, recall <span class="kw" style="color: #003B4F;">OUT</span> <span class="dt" style="color: #AD0000;">NUMBER</span>, flags <span class="kw" style="color: #003B4F;">IN</span> <span class="dt" style="color: #AD0000;">NUMBER</span>) <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span>,</span>
<span id="cb2-13">  <span class="kw" style="color: #003B4F;">MEMBER</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateMerge(self <span class="kw" style="color: #003B4F;">IN</span> <span class="kw" style="color: #003B4F;">OUT</span> RecallImpl, ctx2 <span class="kw" style="color: #003B4F;">IN</span> RecallImpl) <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span></span>
<span id="cb2-14">);</span>
<span id="cb2-15"><span class="op" style="color: #5E5E5E;">/</span></span></code></pre></div>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><span class="co" style="color: #5E5E5E;">-- Create type body</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;">CREATE</span> <span class="kw" style="color: #003B4F;">OR</span> <span class="kw" style="color: #003B4F;">REPLACE</span> <span class="kw" style="color: #003B4F;">TYPE</span> <span class="kw" style="color: #003B4F;">BODY</span> RecallImpl <span class="kw" style="color: #003B4F;">IS</span> </span>
<span id="cb3-3">  </span>
<span id="cb3-4"></span>
<span id="cb3-5">  <span class="kw" style="color: #003B4F;">STATIC</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateInitialize(sctx <span class="kw" style="color: #003B4F;">IN</span> <span class="kw" style="color: #003B4F;">OUT</span> RecallImpl) </span>
<span id="cb3-6">                                                        <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span> <span class="kw" style="color: #003B4F;">IS</span> </span>
<span id="cb3-7">  <span class="cf" style="color: #003B4F;">BEGIN</span></span>
<span id="cb3-8"></span>
<span id="cb3-9">    <span class="co" style="color: #5E5E5E;">-- initialize tp and fn with 0</span></span>
<span id="cb3-10">    sctx <span class="op" style="color: #5E5E5E;">:=</span> RecallImpl(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">0</span>);</span>
<span id="cb3-11">  </span>
<span id="cb3-12">    <span class="kw" style="color: #003B4F;">RETURN</span> ODCIConst.Success;</span>
<span id="cb3-13">  <span class="cf" style="color: #003B4F;">END</span>;</span>
<span id="cb3-14"></span>
<span id="cb3-15"></span>
<span id="cb3-16">  <span class="co" style="color: #5E5E5E;">-- Increase tp and fn count is condition is satisfied</span></span>
<span id="cb3-17">  <span class="kw" style="color: #003B4F;">MEMBER</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateIterate(self <span class="kw" style="color: #003B4F;">IN</span> <span class="kw" style="color: #003B4F;">OUT</span> RecallImpl, </span>
<span id="cb3-18">                                       <span class="fu" style="color: #4758AB;">value</span> <span class="kw" style="color: #003B4F;">IN</span> y_pair) <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span> <span class="kw" style="color: #003B4F;">IS</span></span>
<span id="cb3-19">  <span class="cf" style="color: #003B4F;">BEGIN</span></span>
<span id="cb3-20"></span>
<span id="cb3-21">    <span class="cf" style="color: #003B4F;">IF</span> <span class="fu" style="color: #4758AB;">value</span>.y_true <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">1</span> <span class="cf" style="color: #003B4F;">THEN</span></span>
<span id="cb3-22">      <span class="co" style="color: #5E5E5E;">-- increase true positive count</span></span>
<span id="cb3-23">      <span class="cf" style="color: #003B4F;">IF</span> <span class="fu" style="color: #4758AB;">value</span>.y_pred <span class="op" style="color: #5E5E5E;">&gt;=</span> <span class="fu" style="color: #4758AB;">value</span>.y_true <span class="op" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">value</span>.threshold <span class="cf" style="color: #003B4F;">THEN</span></span>
<span id="cb3-24">        self.tp <span class="op" style="color: #5E5E5E;">:=</span> self.tp <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span>;</span>
<span id="cb3-25">      <span class="cf" style="color: #003B4F;">END</span> <span class="cf" style="color: #003B4F;">IF</span>;</span>
<span id="cb3-26">      </span>
<span id="cb3-27">      <span class="co" style="color: #5E5E5E;">-- increase false negative count</span></span>
<span id="cb3-28">      <span class="cf" style="color: #003B4F;">IF</span> <span class="fu" style="color: #4758AB;">value</span>.y_pred <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="fu" style="color: #4758AB;">value</span>.y_true <span class="op" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">value</span>.threshold <span class="cf" style="color: #003B4F;">THEN</span></span>
<span id="cb3-29">        self.fn <span class="op" style="color: #5E5E5E;">:=</span> self.fn <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span>;</span>
<span id="cb3-30">      <span class="cf" style="color: #003B4F;">END</span> <span class="cf" style="color: #003B4F;">IF</span>;</span>
<span id="cb3-31">    <span class="cf" style="color: #003B4F;">END</span> <span class="cf" style="color: #003B4F;">IF</span>;</span>
<span id="cb3-32">    </span>
<span id="cb3-33">    <span class="kw" style="color: #003B4F;">RETURN</span> ODCIConst.Success;</span>
<span id="cb3-34">  <span class="cf" style="color: #003B4F;">END</span>;</span>
<span id="cb3-35"></span>
<span id="cb3-36"></span>
<span id="cb3-37">  <span class="co" style="color: #5E5E5E;">-- In case of aggregation in window function RECALL_CAF(...)OVER(ORDER BY...) </span></span>
<span id="cb3-38">  <span class="co" style="color: #5E5E5E;">-- the entry leaving the window needs to decrease tp and fn count </span></span>
<span id="cb3-39">  <span class="co" style="color: #5E5E5E;">-- if condition is satisfied</span></span>
<span id="cb3-40">  <span class="kw" style="color: #003B4F;">MEMBER</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateDelete(self <span class="kw" style="color: #003B4F;">IN</span> <span class="kw" style="color: #003B4F;">OUT</span> RecallImpl, </span>
<span id="cb3-41">                                      <span class="fu" style="color: #4758AB;">value</span> <span class="kw" style="color: #003B4F;">IN</span> y_pair) <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span> <span class="kw" style="color: #003B4F;">IS</span></span>
<span id="cb3-42">  <span class="cf" style="color: #003B4F;">BEGIN</span></span>
<span id="cb3-43"></span>
<span id="cb3-44">    <span class="cf" style="color: #003B4F;">IF</span> <span class="fu" style="color: #4758AB;">value</span>.y_true <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">1</span> <span class="cf" style="color: #003B4F;">THEN</span></span>
<span id="cb3-45">      <span class="co" style="color: #5E5E5E;">-- decrease true positive count</span></span>
<span id="cb3-46">      <span class="cf" style="color: #003B4F;">IF</span> <span class="fu" style="color: #4758AB;">value</span>.y_pred <span class="op" style="color: #5E5E5E;">&gt;=</span> <span class="fu" style="color: #4758AB;">value</span>.y_true <span class="op" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">value</span>.threshold <span class="cf" style="color: #003B4F;">THEN</span></span>
<span id="cb3-47">        self.tp <span class="op" style="color: #5E5E5E;">:=</span> self.tp <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>;</span>
<span id="cb3-48">      <span class="cf" style="color: #003B4F;">END</span> <span class="cf" style="color: #003B4F;">IF</span>;</span>
<span id="cb3-49">      </span>
<span id="cb3-50">      <span class="co" style="color: #5E5E5E;">-- decrease false negative count</span></span>
<span id="cb3-51">      <span class="cf" style="color: #003B4F;">IF</span> <span class="fu" style="color: #4758AB;">value</span>.y_pred <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="fu" style="color: #4758AB;">value</span>.y_true <span class="op" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">value</span>.threshold <span class="cf" style="color: #003B4F;">THEN</span></span>
<span id="cb3-52">        self.fn <span class="op" style="color: #5E5E5E;">:=</span> self.fn <span class="op" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">1</span>;</span>
<span id="cb3-53">      <span class="cf" style="color: #003B4F;">END</span> <span class="cf" style="color: #003B4F;">IF</span>;</span>
<span id="cb3-54">    <span class="cf" style="color: #003B4F;">END</span> <span class="cf" style="color: #003B4F;">IF</span>;</span>
<span id="cb3-55"></span>
<span id="cb3-56">    <span class="kw" style="color: #003B4F;">RETURN</span> ODCIConst.Success;</span>
<span id="cb3-57">  <span class="cf" style="color: #003B4F;">END</span>;</span>
<span id="cb3-58"></span>
<span id="cb3-59"></span>
<span id="cb3-60">  <span class="co" style="color: #5E5E5E;">-- Calculate *Recall* from tp and fn count</span></span>
<span id="cb3-61">  <span class="kw" style="color: #003B4F;">MEMBER</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateTerminate(self <span class="kw" style="color: #003B4F;">IN</span> RecallImpl, </span>
<span id="cb3-62">                                         recall <span class="kw" style="color: #003B4F;">OUT</span> <span class="dt" style="color: #AD0000;">NUMBER</span>, </span>
<span id="cb3-63">                                         flags <span class="kw" style="color: #003B4F;">IN</span> <span class="dt" style="color: #AD0000;">NUMBER</span>) <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span> <span class="kw" style="color: #003B4F;">IS</span></span>
<span id="cb3-64">    v_recall <span class="dt" style="color: #AD0000;">number</span>;</span>
<span id="cb3-65">  <span class="cf" style="color: #003B4F;">BEGIN</span></span>
<span id="cb3-66"></span>
<span id="cb3-67">    recall <span class="op" style="color: #5E5E5E;">:=</span> self.tp <span class="op" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">nullif</span>(self.tp <span class="op" style="color: #5E5E5E;">+</span> self.fn, <span class="dv" style="color: #AD0000;">0</span>);</span>
<span id="cb3-68"></span>
<span id="cb3-69">    <span class="kw" style="color: #003B4F;">RETURN</span> ODCIConst.Success;</span>
<span id="cb3-70">  <span class="cf" style="color: #003B4F;">BEGIN</span>;</span>
<span id="cb3-71"></span>
<span id="cb3-72"></span>
<span id="cb3-73">  <span class="co" style="color: #5E5E5E;">-- In case of parallel execution combine tp and fn counts </span></span>
<span id="cb3-74">  <span class="co" style="color: #5E5E5E;">-- from parallel threads</span></span>
<span id="cb3-75">  <span class="kw" style="color: #003B4F;">MEMBER</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> ODCIAggregateMerge(self <span class="kw" style="color: #003B4F;">IN</span> <span class="kw" style="color: #003B4F;">OUT</span> RecallImpl, </span>
<span id="cb3-76">                                     ctx2 <span class="kw" style="color: #003B4F;">IN</span> RecallImpl) <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span> <span class="kw" style="color: #003B4F;">IS</span></span>
<span id="cb3-77">  <span class="cf" style="color: #003B4F;">BEGIN</span></span>
<span id="cb3-78"></span>
<span id="cb3-79">    self.tp <span class="op" style="color: #5E5E5E;">:=</span> self.tp <span class="op" style="color: #5E5E5E;">+</span> ctx2.tp;</span>
<span id="cb3-80">    self.fn <span class="op" style="color: #5E5E5E;">:=</span> self.fn <span class="op" style="color: #5E5E5E;">+</span> ctx2.fn;</span>
<span id="cb3-81">  </span>
<span id="cb3-82">    <span class="kw" style="color: #003B4F;">RETURN</span> ODCIConst.Success;</span>
<span id="cb3-83">  <span class="cf" style="color: #003B4F;">END</span>;</span>
<span id="cb3-84"></span>
<span id="cb3-85"></span>
<span id="cb3-86"><span class="cf" style="color: #003B4F;">END</span>;</span>
<span id="cb3-87"><span class="op" style="color: #5E5E5E;">/</span></span></code></pre></div>

<div class="no-row-height column-margin column-container"><div class="">
<p><em>Parallel aggregation of data</em>:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid mermaid-js" data-tooltip-selector="#mermaid-tooltip-1">flowchart TB
  A[Init] --&gt; B1[Iter /\nDel]
  B1 --&gt; B1
  A --&gt; B2[Iter /\nDel]
  B2 --&gt; B2
  B1 --&gt; C[Merge]
  B2 --&gt; C[Merge]
  C --&gt; D[Terminate]
</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
</div></div><p>Define function that uses the implemented logic.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><span class="kw" style="color: #003B4F;">CREATE</span> <span class="kw" style="color: #003B4F;">OR</span> <span class="kw" style="color: #003B4F;">REPLACE</span> <span class="kw" style="color: #003B4F;">FUNCTION</span> recall_caf(<span class="fu" style="color: #4758AB;">value</span> y_pair) </span>
<span id="cb4-2">                    <span class="kw" style="color: #003B4F;">RETURN</span> <span class="dt" style="color: #AD0000;">NUMBER</span> PARALLEL_ENABLED AGGREGATION <span class="kw" style="color: #003B4F;">USING</span> RecallImpl;</span>
<span id="cb4-3"><span class="op" style="color: #5E5E5E;">/</span></span></code></pre></div>
<p>The function can now be used as a aggregation function including analytical and window features.</p>
<p><em>Example:</em> Recall per kfold and two thresholds.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb5-2">  r.kfold,</span>
<span id="cb5-3">  recall_caf(y_pair(y_true <span class="op" style="color: #5E5E5E;">=&gt;</span> r.y_true, </span>
<span id="cb5-4">                    y_pred <span class="op" style="color: #5E5E5E;">=&gt;</span> r.y_oof)) recall_0_5,</span>
<span id="cb5-5">  recall_caf(y_pair(y_true <span class="op" style="color: #5E5E5E;">=&gt;</span> r.y_true, </span>
<span id="cb5-6">                    y_pred <span class="op" style="color: #5E5E5E;">=&gt;</span> r.y_oof, </span>
<span id="cb5-7">                    threshold <span class="op" style="color: #5E5E5E;">=&gt;</span> <span class="fl" style="color: #AD0000;">0.7</span>)) recall_0_7</span>
<span id="cb5-8">  <span class="kw" style="color: #003B4F;">FROM</span> oof_results r</span>
<span id="cb5-9"><span class="kw" style="color: #003B4F;">GROUP</span> <span class="kw" style="color: #003B4F;">BY</span> r.kfold;</span></code></pre></div>
<table class="table">
<thead>
<tr class="header">
<th>KFOLD</th>
<th style="text-align: center;">RECALL_0_5</th>
<th style="text-align: center;">RECALL_0_7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">0.81</td>
</tr>
<tr class="even">
<td>1</td>
<td style="text-align: center;">0.781</td>
<td style="text-align: center;">0.841</td>
</tr>
<tr class="odd">
<td>2</td>
<td style="text-align: center;">0.754</td>
<td style="text-align: center;">0.81</td>
</tr>
<tr class="even">
<td>3</td>
<td style="text-align: center;">0.79</td>
<td style="text-align: center;">0.838</td>
</tr>
<tr class="odd">
<td>4</td>
<td style="text-align: center;">0.71</td>
<td style="text-align: center;">0.72</td>
</tr>
</tbody>
</table>
<p>or in detail:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb6-2">  r.kfold,</span>
<span id="cb6-3">  r.y_true,</span>
<span id="cb6-4">  r.y_oof,</span>
<span id="cb6-5">  recall_caf(y_pair(y_true <span class="op" style="color: #5E5E5E;">=&gt;</span> r.y_true, </span>
<span id="cb6-6">                    y_pred <span class="op" style="color: #5E5E5E;">=&gt;</span> r.y_oof)) <span class="kw" style="color: #003B4F;">OVER</span> (<span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> r.kfold) recall_0_5,</span>
<span id="cb6-7">  recall_caf(y_pair(y_true <span class="op" style="color: #5E5E5E;">=&gt;</span> r.y_true, </span>
<span id="cb6-8">                    y_pred <span class="op" style="color: #5E5E5E;">=&gt;</span> r.y_oof, </span>
<span id="cb6-9">                    threshold <span class="op" style="color: #5E5E5E;">=&gt;</span> <span class="fl" style="color: #AD0000;">0.7</span>)) <span class="kw" style="color: #003B4F;">OVER</span> (<span class="kw" style="color: #003B4F;">PARTITION</span> <span class="kw" style="color: #003B4F;">BY</span> r.kfold) recall_0_7</span>
<span id="cb6-10"><span class="kw" style="color: #003B4F;">FROM</span> oof_results r;</span></code></pre></div>
<table class="table">
<thead>
<tr class="header">
<th>KFOLD</th>
<th style="text-align: center;">Y_TRUE</th>
<th style="text-align: center;">Y_OOF</th>
<th style="text-align: center;">RECALL_0_5</th>
<th style="text-align: center;">RECALL_0_7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.9768</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">0.81</td>
</tr>
<tr class="even">
<td>0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.56</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">0.81</td>
</tr>
<tr class="odd">
<td>0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.121</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">0.81</td>
</tr>
<tr class="even">
<td>0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.433</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">0.81</td>
</tr>
<tr class="odd">
<td>0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.6768</td>
<td style="text-align: center;">0.72</td>
<td style="text-align: center;">0.81</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>2</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.0068</td>
<td style="text-align: center;">0.754</td>
<td style="text-align: center;">0.87</td>
</tr>
<tr class="even">
<td>2</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.877</td>
<td style="text-align: center;">0.754</td>
<td style="text-align: center;">0.87</td>
</tr>
<tr class="odd">
<td>2</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.1021</td>
<td style="text-align: center;">0.754</td>
<td style="text-align: center;">0.87</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</section>
<section id="resources" class="level1">
<h1>Resources</h1>
<p>More details can be found in the Oracle documentation:</p>
<ul>
<li>https://docs.oracle.com/cd/B10501_01/appdev.920/a96595/dci11agg.htm</li>
<li>https://docs.oracle.com/cd/B12037_01/appdev.101/b10800/dciaggref.htm</li>
</ul>


</section>

 ]]></description>
  <category>SQL</category>
  <category>Oracle</category>
  <category>ML</category>
  <category>Metric</category>
  <guid>https://joatom.github.io/blog/snippets/2022-11-07-udaf/index.html</guid>
  <pubDate>Sun, 06 Nov 2022 23:00:00 GMT</pubDate>
</item>
</channel>
</rss>
